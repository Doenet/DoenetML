<section xml:id="foo-bar">
  <p>hi there</p>
</section>

<section>
  <p>See <xref ref="foo-bar" /></p>
</section>

<p>
  While the next cell is random, the returned value will never be more than
  <m>0.01</m> away from <m>12</m>, since the <c>random()</c> function stays between
  <m>0</m> and <m>1</m>. So we provide <m>12.005</m> as the expected answer, but
  test with an absolute tolerance of <m>\epsilon=0.006</m>.
</p>

<sage doctest="absolute" tolerance="0.006">
   <input>12 + 0.01*random()</input> <output>12.005</output>
</sage>

<p>
  Sage has some functions which affect output, generally making mathematics look
  more like mathematics via <latex /> syntax. This is a simple test, and you
  should see the variable and superscript in italics, properly formatted as
  output when viewed within HTML output. We have provided expected output for
  doctesting, but it is sort of silly to have this as part of <latex /> output,
  even if it is instructive.
</p>

<sage>
   <input>pretty_print(html("$a^2$"))</input> <output>&lt;script type="math/tex">a^2&lt;/script></output>


</sage>

<p>
  Sage, and by extension, the Sage Cell Server, can interpret several languages.
  The next example has code in the <c>R</c> language,<idx><h>R</h></idx> a popular
  open source language for statistics. As an author, you add the attribute <c>
     language="r"
  </c> to your <c>sage</c> element. (The default language is Sage, so you do not
  need to indicate that repeatedly.) Note that a language like <c>R</c> likes to
  use a
  <q>less than</q>
   character, &lt;, special character in XML. You need to escape it by writing <c>
     &amp;lt;
  </c> as we have done in the source for this example. (See the discussion in <xref
    ref="subsection-xml-escape"
    text="type-global"
  />.)
</p>

<p>
  As a reader you learn that the
  <q>Evaluate</q>
   button for a pre-loaded Sage cell will indicate the language in use.
</p>

<sage doctest="not tested" language="r">
   <input>
                ruth &lt;- c(22, 25, 34, 35, 41, 41, 46, 46, 46, 47, 49, 54, 54, 59, 60)
                bonds &lt;- c(16, 25, 24, 19, 33, 25, 34, 46, 37, 33, 42, 40, 37, 34, 49, 73, 46, 45, 45, 5, 26, 28)
                dimaggio &lt;- c(12, 14, 20, 21, 25, 29, 30, 30, 31, 32, 32, 39, 46)
                summary(ruth)
                summary(bonds)
                summary(dimaggio)
                boxplot(ruth, bonds, dimaggio)
                </input>


</sage>

<p>
  The Sage Cell Server supports the following languages: <c>sage</c>, <c>
     gap
  </c>, <c>gp</c>, <c>html</c>, <c>maxima</c>, <c>octave</c>, <c>python</c>, <c>
     r
  </c>, and <c>singular</c>.
</p>

<p>
  Here is another <c>R</c> cell. Unfortunately, it seems Sage's <c>doctest</c>
  facility cannot be used easily with code from other languages. In the source
  for this example, we have employed the <init>XML</init> escape sequence,
  <c>&amp;lt;</c> several times (see
  <xref ref="subsection-xml-escape" text="type-global" />).
</p>

<sage language="r">
   <input>
                age &lt;- c(25, 30, 56)
                gender &lt;- c("male", "female", "male")
                weight &lt;- c(160, 110, 220)
                mydata &lt;- data.frame(age,gender,weight)
                summary(mydata)
                cor(mydata$age,mydata$weight)
                mean(mydata$age)
                sd(mydata$age)
                plot(mydata$age,mydata$weight)
                </input>


</sage>

<p>
  Here is a blank Sage cell that you may use for practice and experimentation
  with the commands above. Note that this cell allows a choice of languages, and
  is not linked with any of the previous cells, so a reader would need to start
  fresh, or cut/paste definitioons from other cells.
</p>

<sage type="practice" />

<p>
  On the other hand a <tag>sage</tag> element with no content will also create
  an empty Sage cell for the reader's use, but now it will be specific to a
  particular language and linked to others of the same language. Run the
  <c>R</c> cell above that defines the variable <c>ruth</c> and then try typing
  <c>summary(ruth)</c> in the cell below. (The linking seems a bit buggy, as it
  repeats the boxplot in the output, as of 2016-06-13).
</p>

<sage language="r" />

<p>
  You can make Sage blocks which are of <c>type="invisible"</c>, which will never
  be shown to a reader, but which get doctested. Why do this? If some code produces
  an error, and you hope it is fixed someday, use an invisible block to raise the
  error. Once fixed, the doctest will fail, and you can adjust your commentary to
  suit. There is such a block right now, <em>but</em> you will need to go to the
  source to see it.
</p>

<sage type="invisible">
   <input>graphs(augment='vertices').next()</input> <output>
                Traceback (most recent call last):
                ...
                NotImplementedError
                </output>


</sage>

<p>
  Our maximum width for text, designed for readability, suggests you should
  format your Sage code with a maximum of about 54 characters. On a mobile
  device, the number of displayed characters might be as low as 28 in portrait
  orientation, and again around 50 in landscape. You can use a variety of
  techniques to shorten long lines, such as using intermediate variables. Since
  Sage is just a huge Python library, you can use any of Python's facilities for
  handling long lines. These include a continuation character (which I try to
  avoid using) or natural places where you can break long lines, such as between
  entries of a list. Also, if writing loops or functions, you may wish to have
  your indentation be only two characters wide (rather than, say, four).
</p>

<p>
  Sage output can sometimes be quite long, though this has improved with some
  changes in Sage's output routines. Output code should be included primarily
  for doctesting purposes, and in this use, you may break at almost whitespace
  character and the doctesting framework will adjust accordingly. You may wish
  to show sample output in a static format, like a PDF, so you can consider
  formatting your output to fit the width constraints of that medium. Or you may
  even adjust exactly what is output, to keep it from being too verbose. Sage
  doctesting also allows for a wild-card style syntax which allows you to skip
  over huge chunks of meaningless or unpredictable output, such as tracebacks on
  error messages.
</p>

<p>
  This paragraph is just a placeholder. It has handful of index entries, all
  starting with the letters
  <q>gas</q>
   , taken from
  <pubtitle>
    Indexing for Editors and Authors: A Practical Guide to Understanding Indexes
  </pubtitle>
   by Leise, Mertes, and Badgett. The intent is to test letter-by-letter versus
  word-by-word sorting of index entries. We use a word-by-word order, resulting
  in:
  <ol>
    <li>gas</li>
    <li>gas masks</li>
    <li>gas production</li>
    <li>gas works</li>
    <li>gasoline</li>
    <li>gastritis</li>
  </ol>
  <idx>gasoline</idx><idx>gas works</idx><idx>gas</idx><idx>gas masks</idx><idx>
    gas production
  </idx><idx>gastritis</idx>
</p>

<paragraphs>
  <title>Titled Sage Cells</title>
  <idx><h>Sage cell</h><h>with a title</h></idx>

  <sage>
     <input>integral(sin(x)^2, x)</input> <output>1/2*x - 1/4*sin(2*x)</output>


  </sage>

  <p>
    You can place Sage cells inside of a <c>paragraphs</c> if you want to give
    them a title, but no numbers, <etc /> Their surrounding box sometimes gets
    clobbered in <latex /> output if they are the first piece of content, so we
    test that here also. A defensive <c>\leavevmode</c> solves the problem.
  </p>
</paragraphs>

<section xml:id="interesting-corollary">
  <title>An Interesting Corollary</title>

  <objectives permid="dEf" xml:id="objectives-structures">
    <title>Fundamental Structures</title>

    <introduction>
      <p>
        This is an <tag>objectives</tag> element you are reading, and this is
        its introduction. This early section has really grown and tries to
        accomplish many things. Not all of them are listed here.
      </p>
    </introduction>

    <ol>
      <li xml:id="objective-structure">
        Display various
        <q>blocks</q>
         , fundamental units of the flow.
      </li>
      <li>More.</li>
      <li>Evermore.</li>
    </ol>

    <conclusion>
      <p>
        This concludes the (incomplete) objectives for this section, so now we
        can carry-on as before.
      </p>
    </conclusion>
  </objectives>

  <introduction>
    <p>
      This is a cross-reference to one of the objectives above, forced to use
      the <c>phrase-global</c> form of the text. It should describe the
      objective as belonging to the <em>section</em> (rather than the
      <em>objectives</em>), since objectives are one-per-subdivision and are numbered
      based upon the containing division: <xref
        ref="objective-structure"
        text="phrase-global"
      />. For comparison this is the (forced) <c>type-global</c>
      cross-reference: <xref ref="objective-structure" text="type-global" />.
    </p>

    <p>
      The Fundamental Theorem comes in two flavors, where usually one is a
      corollary of the other.
    </p>
  </introduction>

  <subsection xml:id="subsection-second-FTC">
    <title>Second Version of <acro>FTC</acro></title>

    <corollary permid="ghI" xml:id="corollary-FTC-derivative">
       <creator>Leibniz, Newton</creator><idx>
        <h>Fundamental Theorem of Calculus</h><h>Corollary</h>
      </idx><statement>
        <p>
          Suppose <m>f(x)</m> is a continuous function. Then
          <men xml:id="equation-alternate-FTC">
             \frac{d}{dx}\definiteintegral{a}{x}{f(t)}{t}=f(x)
          </men>.
        </p>
      </statement> <proof permid="Jkl" xml:id="proof-FTC-corollary">
        <p>
          We simply take the indicated derivative, applying Theorem<nbsp /><xref
            ref="theorem-FTC"
          />
          at <xref ref="equation-use-FTC" /><mdn>
             <mrow xml:id="equation-use-FTC">
               \frac{d}{dx}\definiteintegral{a}{x}{f(t)}{t}&=\frac{d}{dx}\left(F(x)-F(a)\right)


            </mrow> <mrow number="no">
               &=\frac{d}{dx}F(x)-\frac{d}{dx}F(a)
            </mrow> <mrow xml:id="equation-conclude">&=f(x)-0 = f(x)</mrow>
          </mdn>.
        </p>
      </proof> <proof>
        <title>Alternate Proof</title>
        <p>
          You can have multiple proofs, and they can have titles which replace
          the word
          <q>Proof</q>
           as a heading. Here we just exercise displayed math with no automatic
          numbering, and an elective number on the middle equation.<md>
             <mrow>
               \frac{d}{dx}\definiteintegral{a}{x}{f(t)}{t}&=\frac{d}{dx}\left(F(x)-F(a)\right)


            </mrow> <mrow number="yes">
               &=\frac{d}{dx}F(x)-\frac{d}{dx}F(a)
            </mrow> <mrow>&=f(x)-0 = f(x)</mrow>
          </md>
        </p>
      </proof>
    </corollary>

    <p>
      The alternative version of the Fundamental Theorem (<acro>FTC</acro>) in
      <xref ref="equation-alternate-FTC" /> is a compact way to express the
      result.
    </p>

    <p>For testing purposes, there is a simple bare Sage Cell here.</p>
    <sage>
       <input>
                    c = 832
                    c
                    </input>


    </sage>

    <example permid="mNo" xml:id="example-mysterious">
      <title>A Mysterious Derivative!</title>
      <p>
        So if we define a function with its variable employed as a limit of
        integration, like so
        <me>K(z)=\definiteintegral{345}{z}{x^4\sin(x^2)}{x}</me> then we get the
        derivative of that function so easily it seems like a mystery,
        <me>\frac{d}{dz}K(z)=z^4\sin(z^2)</me>. That's it.
      </p>

      <p>
        For testing purposes, there is a simple Sage Cell here, buried inside an
        example that should be a knowl (embedded in the page).
      </p>

      <sage> <input>2+2</input> </sage>

      <p>
        We test a Sage cell inside a knowl, which should set the value of a
        variable that will be available to subsequent cells within the knowl.
      </p>

      <sage>
         <input>
                        a = 6
                        a
                        </input>


      </sage>

      <sage>
         <input>
                        b = a + 10
                        b
                        </input>


      </sage>

      <p>
        Even if you ran the cell at the top of this page, within this knowl the
        value of the variable <c>c</c> is not known, so the next cell will cause
        an error.
      </p>

      <sage>
         <input>
                        c + 400
                        </input>


      </sage>
    </example>

    <p>
      The Sage cells on a page will
      <q>remember</q>
       results computed elsewhere on the page. If you rely on this feature,
      remind your readers to evaluate all the necessary cells and that they
      perhaps need to be evaluated in a certain order.
    </p>

    <sage> <input>
                    c/2
                    </input> </sage>

    <p>
      There are some Sage cells in the previous (knowled) <tag>example</tag>. The
      results there are restricted to the knowl. In other words, the scope of those
      cells is the knowl. So if you opened the example and executed the Sage cells
      there, or if you skipped the example entirely, the next cell should not
      <q>know</q>
       the values of those variables and will raise an error.
    </p>

    <sage> <input>
                    a + b
                    </input> </sage>

    <p>
      We cross-reference the example just prior,
      <xref ref="example-mysterious" text="type-global" />, to test the simple Sage
      cells that will now be part of a cross-reference knowl (an external file).
    </p>

    <claim xml:id="claim-with-cases">
      <title>An Equivalent Claim</title>
      <statement>
        <p>
          This claim is an equivalence: it is true if and only if it is correct.
        </p>
      </statement>
      <proof>
        <p>
          Our purpose here is to show how you can structure a proof with cases,
          such as an equivalence structured with the arrows typically used to
          demonstrate the two
          <q>directions</q>
           involved in the proof, by using the <c>direction</c> attribute on a
          <c>case</c> element.
        </p>

        <case direction="forward">
          <p>
            Nulla non lectus suscipit, bibendum leo quis, dignissim justo. In
            urna turpis, tincidunt id elementum id, faucibus ac tellus.
          </p>
        </case>

        <case direction="backward">
          <p>
            Quisque auctor ligula turpis, ut aliquam urna consectetur hendrerit.
            Aenean porta dolor et justo facilisis feugiat in sed sapien. Nullam
            porta ex et commodo semper.
          </p>
        </case>

        <case xml:id="inductive-step">
          <title>Case 3b: The inductive step</title>

          <p>
            A case may also have a <c>title</c>, whose formatting and structure is
            entirely up to the author. This then becomes the text of a cross-reference,
            as well.
          </p>
        </case>

        <case permid="pqR" direction="forward" xml:id="forward">
          <title>Necessity</title>

          <p>If you like, you can have both indications.</p>
        </case>

        <case xml:id="empty-case">
          <p>No direction, no title, then just a generic title.</p>
        </case>
      </proof>
      <proof>
        <title>Exciting Proof!</title>
        <p>
          We test here that punctuation at the end of the title of a proof is
          handled correctly.
        </p>
      </proof>
      <proof>
        <title>Exact Proof</title>
        <p>
          This proof should fill exactly three lines (as of defaults in place
          2018-12-31) and so the tombstone/Halmos should be on a fourth line,
          and then <em>flush right</em>. xxx xxx xxx xxx xxx xxx xxx xxx xxx xxx
          xxx xxx xxx xxx xxx.
        </p>
      </proof>


    </claim>
  </subsection>

  <subsection>
    <title>
      A Pedagogical Note about
      <xref ref="subsection-second-FTC" text="type-global" />
    </title>

    <subsubsection xml:id="subsubsection-different-integrals">
      <title>Symbolic and Numerical Integrals</title>

      <p>
        The Fundamental Theorem explains why we use the same notation for a
        definite integral, which is a numerical calculation,<fn>
           Which I think sometimes students lose sight of.
        </fn> and an antiderivative, which is a symbolic expression.
      </p>

      <exercise permid="Stu" xml:id="exercise-essay">
        <title>Essay Question: Compare and Contrast</title>
        <statement>
          <p>
            Write a short paragraph which compares, and contrasts, the definite
            and indefinite integral. This is an exercise which sits in the midst
            of the narrative, so is formatted more like an example or a remark.
            It can have a hint and a solution, but this one does not. It can
            have a title, which this one does.
          </p>
        </statement>
        <hint><p>Start writing!</p></hint>


      </exercise>


    </subsubsection>

    <subsubsection>
      <title />

      <p>
        This subsubsection has a title in the source, but it is empty. That's
        OK, but not advisable since titles get used lots of places (such as page
        headers and the table of contents).
      </p>
    </subsubsection>

    <subsubsection>
      <title>Advice</title>

      <p>
        Using an
        <q>integral sign</q>
         for an antiderivative (aka indefinite integral) would seem to make the
        Fundamental Theorem a <foreign xml:lang="fr-FR">fait accompli</foreign>.
        So I would suggest not conflating the notation for two very different things
        until the Fundamental Theorem exposes them as being highly related.
      </p>

      <example xml:id="example-structured">
        <title>An Example of Structure</title>
        <statement>
          <p>
            This is an example of an example with a bit more structure.
            Specifically, the example has a <c>title</c>, as usual, but then has
            a <c>statement</c>, which is separate from the <c>solution</c>. Why did
            we implement an example in two ways?
          </p>
        </statement>
        <solution>
          <p>
            Authors asked for it and it seemed a very natural thing to do, even
            if we only had an unstructured version for a long time.
          </p>
        </solution>
      </example>

      <question xml:id="sample-question">
        <title>An Example of a Question</title>
        <statement>
          <p>
            Any kind of question can be marked as such with <tag>question</tag>.
            Or similarly, as a <tag>problem</tag>. They behave identically to
            <c>example</c>s, such as the one preceding and are numbered along with
            theorems, examples. etc.
          </p>
        </statement>
        <solution>
          <p>
            You can have a solution. Or several, even if you don't ask a
            question.
          </p>
        </solution>
        <solution><p>See?</p></solution>
      </question>

      <exercise xml:id="inline-exercise">
        <title>An Inline Exercise</title>

        <statement>
          <p>
            There are lots of exercises in this sample article, but mostly they
            are in special exercise sections. Sometimes you just want to
            sprinkle some exercises through the narrative. We call these
            <term>inline exercises</term>, in contrast to <term>
               divisional exercises
            </term>. The inline exercises look a bit more like a theorem or
            definition, with titles and fully-qualified numbers.
          </p>

          <p>These may also have hints, answers and solutions.</p>
        </statement>
        <hint><p>A good hint.</p></hint>
        <answer permid="Vwx"><p permid="Xyz">42.</p></answer>
        <solution>
          <p>
            If your exercise feels like proving a theorem, then you might want
            to make some comments, but also clearly delineate which part of the
            solution is a the complete proof.
          </p>
          <proof>
            <p>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin
              lorem diam, convallis in nulla sed, accumsan fermentum urna.
              Pellentesque aliquet leo elit, ut consequat nunc dapibus ac. Sed
              lobortis leo tincidunt, vulputate nunc at, ultricies leo. Vivamus
              purus diam, tristique laoreet purus eget, mollis gravida sapien.
              Nunc vulputate nisl ac mauris hendrerit cursus. Sed vel molestie
              velit. Suspendisse sem sem, elementum at vehicula id, volutpat ac
              mi. Nullam ullamcorper fringilla purus in accumsan. Mauris at nunc
              accumsan orci dictum vulputate id id augue. Suspendisse at
              dignissim elit, non euismod nunc. Aliquam faucibus magna ac
              molestie semper. Aliquam hendrerit sem sit amet metus congue
              tempor. Donec laoreet laoreet metus, id interdum purus mattis
              vulputate. Proin condimentum vitae erat varius mollis. Donec
              venenatis libero sed turpis pretium tempor.
            </p>

            <p>
              Praesent rutrum scelerisque felis sit amet adipiscing. Phasellus
              in mollis velit. Nunc malesuada felis sit amet massa cursus, eget
              elementum neque viverra. Integer sagittis dictum turpis vel
              aliquet. Fusce ut suscipit dolor, nec tristique nisl. Aenean
              luctus, leo et ornare fermentum, nibh dui vulputate leo, nec
              tincidunt augue ipsum sed odio. Nunc non erat sollicitudin,
              iaculis eros consequat, dapibus eros.
            </p>
          </proof>


        </solution>


      </exercise>

      <example xml:id="example-math-title">
        <title>
          An Example of with <m>\frac12</m> math formula
          <m>\displaystyle{\int e^x \, dx}</m> in the title
        </title>
        <statement>
          <p>
            Just for testing math in knowls, and also extra whitespace in a
            <tag>p</tag>.
          </p>
        </statement>


      </example>

      <p>
        There are many different blocks you can employ, and they mostly behave
        the same way. A <tag>project</tag><idx><h>project</h></idx> is very similar
        to a <tag>question</tag><idx><h>question</h></idx> or <tag>problem</tag><idx><h>
            problem
          </h></idx>
      </p>

      <project>
        <title>Start Exploring <pretext /></title>

        <p>
          You could grab the <c>minimal.xml</c> file from the
          <c>examples/minimal</c> directory and experiment with that.
        </p>

        <p>
          Projects get their own independent numbering scheme, since they may be
          central to your textbook, workbook, or lab manual. If you process this
          sample article with <c>--stringparam numbering.projects.level 0</c>
          then you will get consecutive numbers from the beginning of your book,
          starting with 1.
        </p>
      </project>

      <exploration>
        <title>Exploring Explorations</title>

        <statement>
          <p>
            This is an <tag>exploration</tag>.<idx><h>exploration</h></idx>
            Other similar possibilities are <tag>project</tag><idx>
              <h>project</h>
            </idx>, <tag>activity</tag><idx><h>activity</h></idx>,
            <tag>task</tag><idx><h>task</h></idx>, and <tag>investigation</tag><idx>
              <h>investigation</h>
            </idx>.
          </p>

          <p>
            Note that projects, activities, explorations, tasks and
            investigations <em>share</em> the independent numbering scheme, so
            it is really only intended you use one of these. If you want a
            variant of the name (<eg />
            <q>Directed Activity</q>
             ) you can use the <tag>rename</tag><idx>
              <h>rename an environment</h>
            </idx> facility (<xref ref="rename-facility" text="type-global" />).
          </p>
        </statement>

        <solution>
          <p>
            This is a
            <q>solution</q>
             to the exploration. In practice, you might choose to not make this
            visible for students, but instead include it as part of some
            guidance you might provide to instructors (<eg /> an
            <pubtitle>Instructor's Manual</pubtitle>
             ).
          </p>
        </solution>
      </exploration>

      <activity xml:id="activity-with-hint-answer-solution">
        <title>Hints, Answers, Solutions</title>

        <prelude>
          <p>
            This is quite the activity upcoming. This is a <c>prelude</c>
            authored within the <c>activity</c> element, but visually just
            prior.
          </p>
        </prelude>

        <statement>
          <p>
            Another variant of these project-like items is to possibly include a
            <tag>hint</tag> and an <tag>answer</tag> before the
            <tag>solution</tag>.
          </p>
        </statement>

        <hint><p>Just a little help.</p></hint>

        <answer><p>The result, but no help in getting there.</p></answer>

        <solution><p>Everything to get it all done, in detail.</p></solution>

        <postlude>
          <p>
            This was quite the activity just now. This is a <c>postlude</c>
            authored within the <c>activity</c> element, but visually just
            after.
          </p>
        </postlude>


      </activity>

      <note xml:id="note-remark">
        <title>A Note on Remarks</title>

        <p>
          <tag>remark</tag>, <tag>convention</tag>, <tag>note</tag>, <tag>
             observation
          </tag> and <tag>warning</tag> are designed to hold very simple contents,
          with no additional structure (no proofs, no solutions, <etc />).
        </p>

        <p>
          But they do carry a title and a number, can be the target of a
          cross-reference, and may be optionally knowlized in HTML with the
          <c>html.knowl.remark</c> processing switch.
        </p>
      </note>

      <aside xml:id="an-aside">
        <title>An Aside</title>
        <idx>aside</idx>

        <p>
          An <tag>aside</tag> is similar to a remark, but is not as critical to
          the narrative. It is not numbered, and so requires a title. It can be
          the target of a cross-reference. They are meant to be short, and so
          are not knowlized at their first appearance. If the content is
          appropriate, these can be marked as <tag>historical</tag> or
          <tag>biographical</tag>, though longer items should use subdivisions (<eg />
          sections, subsections) instead.
        </p>
      </aside>

      <p>An <tag>exercise</tag> can be structured with <tag>task</tag>.</p>

      <exercise xml:id="exercise-structured">
        <title>A very structured exercise</title>

        <introduction>
          <p>
            This is an over-arching introduction to the whole exercise. We
            follow with some tasks. In interdum suscipit ullamcorper. Morbi sit
            amet malesuada augue, id vestibulum magna. Nulla blandit dui metus,
            malesuada mollis sapien ullamcorper sit amet. Nulla at neque nisi.
            Integer vel porta felis.
          </p>
        </introduction>

        <task>
          <title>A super-simple task</title>
          <p>
            This first task is very simple, just a paragraph. In interdum
            suscipit ullamcorper. Morbi sit amet malesuada augue, id vestibulum
            magna. Nulla blandit dui metus, malesuada mollis sapien ullamcorper
            sit amet. Nulla at neque nisi. Integer vel porta felis.
          </p>
        </task>

        <task>
          <p>
            Now three paragraphs. In interdum suscipit ullamcorper. Morbi sit
            amet malesuada augue, id vestibulum magna. Nulla blandit dui metus,
            malesuada mollis sapien ullamcorper sit amet. Nulla at neque nisi.
            Integer vel porta felis.
          </p>
          <p>
            In interdum suscipit ullamcorper. Morbi sit amet malesuada augue, id
            vestibulum magna. Nulla blandit dui metus, malesuada mollis sapien
            ullamcorper sit amet. Nulla at neque nisi. Integer vel porta felis.
          </p>
          <p>
            In interdum suscipit ullamcorper. Morbi sit amet malesuada augue, id
            vestibulum magna. Nulla blandit dui metus, malesuada mollis sapien
            ullamcorper sit amet. Nulla at neque nisi. Integer vel porta felis.
          </p>
        </task>

        <task>
          <title>
            A title of a task that has a subtask with an <tag>answer</tag> for
            the Solutions
          </title>
          <introduction>
            <p>
              This second task is further divided by more tasks. This is its
              introduction. In interdum suscipit ullamcorper. Morbi sit amet
              malesuada augue, id vestibulum magna. Nulla blandit dui metus,
              malesuada mollis sapien ullamcorper sit amet. Nulla at neque nisi.
              Integer vel porta felis.
            </p>
            <p>
              In interdum suscipit ullamcorper. Morbi sit amet malesuada augue,
              id vestibulum magna. Nulla blandit dui metus, malesuada mollis
              sapien ullamcorper sit amet. Nulla at neque nisi. Integer vel
              porta felis.
            </p>
          </introduction>
          <task>
            <title>
              A task with a title and an <tag>answer</tag> for the Solutions
            </title>
            <statement>
              <p>
                A really simple subtask. In interdum suscipit ullamcorper. Morbi
                sit amet malesuada augue, id vestibulum magna. Nulla blandit dui
                metus, malesuada mollis sapien ullamcorper sit amet. Nulla at
                neque nisi. Integer vel porta felis.
              </p>
              <p>A short paragraph, before an answer.</p>
            </statement>
            <answer>
              <p>With a proof.</p>
              <proof>
                <p>
                  In interdum suscipit ullamcorper. Morbi sit amet malesuada
                  augue, id vestibulum magna. Nulla blandit dui metus, malesuada
                  mollis sapien ullamcorper sit amet. Nulla at neque nisi.
                  Integer vel porta felis.
                </p>
              </proof>
              <p>And a bit more to say.</p>
            </answer>


          </task>
          <task>
             <statement>
              <p>
                A subtask with an answer. In interdum suscipit ullamcorper.
                Morbi sit amet malesuada augue, id vestibulum magna. Nulla
                blandit dui metus, malesuada mollis sapien ullamcorper sit amet.
                Nulla at neque nisi. Integer vel porta felis.
              </p>
            </statement> <answer>
              <p>
                Right! In interdum suscipit ullamcorper. Morbi sit amet
                malesuada augue, id vestibulum magna. Nulla blandit dui metus,
                malesuada mollis sapien ullamcorper sit amet. Nulla at neque
                nisi. Integer vel porta felis.
              </p>
            </answer>
          </task>
          <task>
             <introduction>
              <p>
                Three simple sub-sub-tasks. In interdum suscipit ullamcorper.
                Morbi sit amet malesuada augue, id vestibulum magna. Nulla
                blandit dui metus, malesuada mollis sapien ullamcorper sit amet.
                Nulla at neque nisi. Integer vel porta felis.
              </p>
            </introduction> <task>
              <p>First subsubtask. Short paragraph.</p>
            </task> <task>
              <title>A second three-deep subsubtask!</title>
              <p>
                Second subsubtask. In interdum suscipit ullamcorper. Morbi sit
                amet malesuada augue, id vestibulum magna. Nulla blandit dui
                metus, malesuada mollis sapien ullamcorper sit amet. Nulla at
                neque nisi. Integer vel porta felis.
              </p>
              <p>
                In interdum suscipit ullamcorper. Morbi sit amet malesuada
                augue, id vestibulum magna. Nulla blandit dui metus, malesuada
                mollis sapien ullamcorper sit amet. Nulla at neque nisi. Integer
                vel porta felis.
              </p>
            </task> <task>
              <p>
                Third subsubtask. In interdum suscipit ullamcorper. Morbi sit
                amet malesuada augue, id vestibulum magna. Nulla blandit dui
                metus, malesuada mollis sapien ullamcorper sit amet. Nulla at
                neque nisi. Integer vel porta felis.
              </p>
              <p>In interdum suscipit ullamcorper</p>
              <p>
                In interdum suscipit ullamcorper. Morbi sit amet malesuada
                augue, id vestibulum magna. Nulla blandit dui metus, malesuada
                mollis sapien ullamcorper sit amet. Nulla at neque nisi. Integer
                vel porta felis.
              </p>
            </task> <conclusion>
              <p>
                The conclusion of the structured subtask. In interdum suscipit
                ullamcorper. Morbi sit amet malesuada augue, id vestibulum
                magna. Nulla blandit dui metus, malesuada mollis sapien
                ullamcorper sit amet. Nulla at neque nisi. Integer vel porta
                felis.
              </p>
            </conclusion>
          </task>
          <task>
            <p>
              A simple task as the last subtask. In interdum suscipit
              ullamcorper. Morbi sit amet malesuada augue, id vestibulum magna.
              Nulla blandit dui metus, malesuada mollis sapien ullamcorper sit
              amet. Nulla at neque nisi. Integer vel porta felis.
            </p>
          </task>
          <conclusion>
            <p>
              This concludes our structured second task. In interdum suscipit
              ullamcorper. Morbi sit amet malesuada augue, id vestibulum magna.
              Nulla blandit dui metus, malesuada mollis sapien ullamcorper sit
              amet. Nulla at neque nisi. Integer vel porta felis.
            </p>
          </conclusion>


        </task>

        <task>
           <statement>
            <p>
              This third top-level task is intermediate in complexity, you are
              reading the <c>statement</c>, which is followed by more items. In interdum
              suscipit ullamcorper. Morbi sit amet malesuada augue, id vestibulum
              magna. Nulla blandit dui metus, malesuada mollis sapien ullamcorper
              sit amet. Nulla at neque nisi. Integer vel porta felis.
            </p>
          </statement>
          <hint>
            <p>
              One hint. In interdum suscipit ullamcorper. Morbi sit amet
              malesuada augue, id vestibulum magna. Nulla blandit dui metus,
              malesuada mollis sapien ullamcorper sit amet. Nulla at neque nisi.
              Integer vel porta felis.
            </p>
            <p>
              In interdum suscipit ullamcorper. Morbi sit amet malesuada augue,
              id vestibulum magna. Nulla blandit dui metus, malesuada mollis
              sapien ullamcorper sit amet. Nulla at neque nisi. Integer vel
              porta felis.
            </p>
          </hint>
          <answer>
            <p>First answer. In interdum suscipit ullamcorper.</p>
          </answer> <answer>
            <p>
              Second answer. In interdum suscipit ullamcorper. Morbi sit amet
              malesuada augue, id vestibulum magna. Nulla blandit dui metus,
              malesuada mollis sapien ullamcorper sit amet. Nulla at neque nisi.
              Integer vel porta felis.
            </p>
            <p>
              In interdum suscipit ullamcorper. Morbi sit amet malesuada augue,
              id vestibulum magna. Nulla blandit dui metus, malesuada mollis
              sapien ullamcorper sit amet. Nulla at neque nisi. Integer vel
              porta felis.
            </p>
            <p>
              In interdum suscipit ullamcorper. Morbi sit amet malesuada augue,
              id vestibulum magna. Nulla blandit dui metus, malesuada mollis
              sapien ullamcorper sit amet. Nulla at neque nisi. Integer vel
              porta felis.
            </p>
          </answer>
          <solution>
            <p>
              At last, the solution. In interdum suscipit ullamcorper. Morbi sit
              amet malesuada augue, id vestibulum magna. Nulla blandit dui
              metus, malesuada mollis sapien ullamcorper sit amet. Nulla at
              neque nisi. Integer vel porta felis.
            </p>
          </solution>
        </task>

        <conclusion>
          <p>
            This is a conclusion where you could summarize the exercise. In
            interdum suscipit ullamcorper. Morbi sit amet malesuada augue, id
            vestibulum magna. Nulla blandit dui metus, malesuada mollis sapien
            ullamcorper sit amet. Nulla at neque nisi. Integer vel porta felis.
          </p>
        </conclusion>


      </exercise>

      <p>
        The following <tag>project</tag> is nearly identical to the preceding
        <tag>exercise</tag>.
      </p>

      <project permid="aBc" xml:id="project-structured">
        <title>A very structured project</title>

        <prelude>
          <p>
            The next block is a project, demonstrating the use of the
            <c>task</c> element to structure its parts. You are reading the
            <c>prelude</c> now. The project has lots of nonsense words, so we
            can test spacing the nested items. In interdum suscipit ullamcorper.
            Morbi sit amet malesuada augue, id vestibulum magna. Nulla blandit
            dui metus, malesuada mollis sapien ullamcorper sit amet. Nulla at
            neque nisi. Integer vel porta felis.
          </p>
          <p>
            In interdum suscipit ullamcorper. Morbi sit amet malesuada augue, id
            vestibulum magna. Nulla blandit dui metus, malesuada mollis sapien
            ullamcorper sit amet. Nulla at neque nisi. Integer vel porta felis.
          </p>
        </prelude>

        <introduction>
          <p>
            This is an over-arching introduction to the whole project. We follow
            with some tasks. In interdum suscipit ullamcorper. Morbi sit amet
            malesuada augue, id vestibulum magna. Nulla blandit dui metus,
            malesuada mollis sapien ullamcorper sit amet. Nulla at neque nisi.
            Integer vel porta felis.
          </p>
        </introduction>

        <task>
          <p>
            This first task is very simple, just a paragraph. In interdum
            suscipit ullamcorper. Morbi sit amet malesuada augue, id vestibulum
            magna. Nulla blandit dui metus, malesuada mollis sapien ullamcorper
            sit amet. Nulla at neque nisi. Integer vel porta felis.
          </p>
        </task>

        <task permid="abC">
          <p>
            Now three paragraphs. In interdum suscipit ullamcorper. Morbi sit
            amet malesuada augue, id vestibulum magna. Nulla blandit dui metus,
            malesuada mollis sapien ullamcorper sit amet. Nulla at neque nisi.
            Integer vel porta felis.
          </p>
          <p>
            In interdum suscipit ullamcorper. Morbi sit amet malesuada augue, id
            vestibulum magna. Nulla blandit dui metus, malesuada mollis sapien
            ullamcorper sit amet. Nulla at neque nisi. Integer vel porta felis.
          </p>
          <p>
            In interdum suscipit ullamcorper. Morbi sit amet malesuada augue, id
            vestibulum magna. Nulla blandit dui metus, malesuada mollis sapien
            ullamcorper sit amet. Nulla at neque nisi. Integer vel porta felis.
          </p>
        </task>

        <task>
           <introduction>
            <p>
              This second task is further divided by more tasks. This is its
              introduction. In interdum suscipit ullamcorper. Morbi sit amet
              malesuada augue, id vestibulum magna. Nulla blandit dui metus,
              malesuada mollis sapien ullamcorper sit amet. Nulla at neque nisi.
              Integer vel porta felis.
            </p>
            <p>
              In interdum suscipit ullamcorper. Morbi sit amet malesuada augue,
              id vestibulum magna. Nulla blandit dui metus, malesuada mollis
              sapien ullamcorper sit amet. Nulla at neque nisi. Integer vel
              porta felis.
            </p>
          </introduction> <task>
             <statement>
              <p>
                A really simple subtask. In interdum suscipit ullamcorper. Morbi
                sit amet malesuada augue, id vestibulum magna. Nulla blandit dui
                metus, malesuada mollis sapien ullamcorper sit amet. Nulla at
                neque nisi. Integer vel porta felis.
              </p>
              <p>A short paragraph, before an answer.</p>
            </statement> <answer>
              <p>With a proof.</p>
              <proof>
                <p>
                  In interdum suscipit ullamcorper. Morbi sit amet malesuada
                  augue, id vestibulum magna. Nulla blandit dui metus, malesuada
                  mollis sapien ullamcorper sit amet. Nulla at neque nisi.
                  Integer vel porta felis.
                </p>
              </proof>
              <p>And a bit more to say.</p>
            </answer>
          </task> <task>
             <statement>
              <p>
                A subtask with an answer. In interdum suscipit ullamcorper.
                Morbi sit amet malesuada augue, id vestibulum magna. Nulla
                blandit dui metus, malesuada mollis sapien ullamcorper sit amet.
                Nulla at neque nisi. Integer vel porta felis.
              </p>
            </statement> <answer>
              <p>
                Right! In interdum suscipit ullamcorper. Morbi sit amet
                malesuada augue, id vestibulum magna. Nulla blandit dui metus,
                malesuada mollis sapien ullamcorper sit amet. Nulla at neque
                nisi. Integer vel porta felis.
              </p>
            </answer>
          </task> <task xml:id="project-task-level-two">
             <introduction>
              <p>
                Two simple sub-sub-tasks. In interdum suscipit ullamcorper.
                Morbi sit amet malesuada augue, id vestibulum magna. Nulla
                blandit dui metus, malesuada mollis sapien ullamcorper sit amet.
                Nulla at neque nisi. Integer vel porta felis.
              </p>
            </introduction> <task>
              <p>First subsubtask. Short paragraph.</p>
            </task> <task>
              <p>
                Second subsubtask. In interdum suscipit ullamcorper. Morbi sit
                amet malesuada augue, id vestibulum magna. Nulla blandit dui
                metus, malesuada mollis sapien ullamcorper sit amet. Nulla at
                neque nisi. Integer vel porta felis.
              </p>
              <p>
                In interdum suscipit ullamcorper. Morbi sit amet malesuada
                augue, id vestibulum magna. Nulla blandit dui metus, malesuada
                mollis sapien ullamcorper sit amet. Nulla at neque nisi. Integer
                vel porta felis.
              </p>
            </task> <task xml:id="deep-terminal-task">
               <statement>
                <p>
                  Third subsubtask. In interdum suscipit ullamcorper. Morbi sit
                  amet malesuada augue, id vestibulum magna. Nulla blandit dui
                  metus, malesuada mollis sapien ullamcorper sit amet. Nulla at
                  neque nisi. Integer vel porta felis.
                </p>
                <p>In interdum suscipit ullamcorper</p>
                <p>
                  In interdum suscipit ullamcorper. Morbi sit amet malesuada
                  augue, id vestibulum magna. Nulla blandit dui metus, malesuada
                  mollis sapien ullamcorper sit amet. Nulla at neque nisi.
                  Integer vel porta felis.
                </p>
              </statement>
            </task> <conclusion>
              <p>
                The conclusion of the structured subtask. In interdum suscipit
                ullamcorper. Morbi sit amet malesuada augue, id vestibulum
                magna. Nulla blandit dui metus, malesuada mollis sapien
                ullamcorper sit amet. Nulla at neque nisi. Integer vel porta
                felis.
              </p>
            </conclusion>
          </task> <task>
            <p>
              A simple task as the last subtask. In interdum suscipit
              ullamcorper. Morbi sit amet malesuada augue, id vestibulum magna.
              Nulla blandit dui metus, malesuada mollis sapien ullamcorper sit
              amet. Nulla at neque nisi. Integer vel porta felis.
            </p>
          </task> <conclusion>
            <p>
              This concludes our structured second task. In interdum suscipit
              ullamcorper. Morbi sit amet malesuada augue, id vestibulum magna.
              Nulla blandit dui metus, malesuada mollis sapien ullamcorper sit
              amet. Nulla at neque nisi. Integer vel porta felis.
            </p>
          </conclusion>
        </task>

        <task>
           <statement>
            <p>
              This third top-level task is intermediate in complexity, you are
              reading the <c>statement</c>, which is followed by more items. In interdum
              suscipit ullamcorper. Morbi sit amet malesuada augue, id vestibulum
              magna. Nulla blandit dui metus, malesuada mollis sapien ullamcorper
              sit amet. Nulla at neque nisi. Integer vel porta felis.
            </p>
          </statement>
          <hint>
            <p>
              One hint. In interdum suscipit ullamcorper. Morbi sit amet
              malesuada augue, id vestibulum magna. Nulla blandit dui metus,
              malesuada mollis sapien ullamcorper sit amet. Nulla at neque nisi.
              Integer vel porta felis.
            </p>
            <p>
              In interdum suscipit ullamcorper. Morbi sit amet malesuada augue,
              id vestibulum magna. Nulla blandit dui metus, malesuada mollis
              sapien ullamcorper sit amet. Nulla at neque nisi. Integer vel
              porta felis.
            </p>
          </hint>
          <answer>
            <p>First answer. In interdum suscipit ullamcorper.</p>
          </answer> <answer>
            <p>
              Second answer. In interdum suscipit ullamcorper. Morbi sit amet
              malesuada augue, id vestibulum magna. Nulla blandit dui metus,
              malesuada mollis sapien ullamcorper sit amet. Nulla at neque nisi.
              Integer vel porta felis.
            </p>
            <p>
              In interdum suscipit ullamcorper. Morbi sit amet malesuada augue,
              id vestibulum magna. Nulla blandit dui metus, malesuada mollis
              sapien ullamcorper sit amet. Nulla at neque nisi. Integer vel
              porta felis.
            </p>
            <p>
              In interdum suscipit ullamcorper. Morbi sit amet malesuada augue,
              id vestibulum magna. Nulla blandit dui metus, malesuada mollis
              sapien ullamcorper sit amet. Nulla at neque nisi. Integer vel
              porta felis.
            </p>
          </answer>
          <solution>
            <p>
              At last, the solution. In interdum suscipit ullamcorper. Morbi sit
              amet malesuada augue, id vestibulum magna. Nulla blandit dui
              metus, malesuada mollis sapien ullamcorper sit amet. Nulla at
              neque nisi. Integer vel porta felis.
            </p>
          </solution>
        </task>

        <conclusion>
          <p>
            This is a conclusion where you could summarize the project. In
            interdum suscipit ullamcorper. Morbi sit amet malesuada augue, id
            vestibulum magna. Nulla blandit dui metus, malesuada mollis sapien
            ullamcorper sit amet. Nulla at neque nisi. Integer vel porta felis.
          </p>
        </conclusion>

        <postlude>
          <p>
            This postlude appears visually outside the project, but is authored
            within, to make clear its attachment to the project. In interdum
            suscipit ullamcorper. Morbi sit amet malesuada augue, id vestibulum
            magna. Nulla blandit dui metus, malesuada mollis sapien ullamcorper
            sit amet. Nulla at neque nisi. Integer vel porta felis.
          </p>
        </postlude>


      </project>

      <p>
        The following <tag>example</tag>, from Elise Desgreniers, is structured with
        <tag>task</tag>.
      </p>

      <example xml:id="example-structured-with-task">
        <title>Notation mathématique 2</title>
        <introduction>
          <p>
            Écrivez chacun des exemples suivants avec les conditions
            pertinentes.
          </p>
        </introduction>
        <task>
           <statement>
            <p>Soit l'ensemble <m>A=\lbrace 1,2,3,4,5\rbrace</m>.</p>
            <p>
              On constate que cet ensemble contient uniquement des entiers
              positifs allant de 1 à 5.
            </p>
            <p>
              Donc, on peut écrire
              <m>
                 A=\lbrace x\mid x\in\mathbb{N}\text{ et } 1\leq x\leq 5\rbrace
              </m>.
            </p>
          </statement>
        </task>
        <task>
           <statement><p><m>\{3,6,9,12,15,\ldots,27,30\}</m></p></statement>
          <hint><p>Ce sont des multiples de 3.</p></hint>
          <answer>
            <p>
              <m>
                 \{x\mid x=3y \text{ et } 1\leq y\leq 10 \text{ et } y\in\mathbb{N}\}


              </m>
            </p>
          </answer>
        </task>
        <task>
           <statement><p><m>\{1,3,5,7,9,11,\ldots\}</m></p></statement>
          <hint><p>Ce sont des nombres impairs.</p></hint>
          <answer>
            <p><m>\{x\mid x\mod 2=1 \text{ et } x\in\mathbb{N}\}</m></p>
          </answer>
        </task>
        <task>
           <statement>
            <p><m>\{2,3,5,7,11,13,17,19,23,\ldots\}</m></p>
          </statement>
          <hint><p>Ce sont des nombres premiers.</p></hint>
          <answer>
            <p><m>\{x\mid x\text{ est un nombre premier positif}\}</m></p>
          </answer>
        </task>
        <task>
           <statement><p><m>\{1,4,9,16,25,36,\ldots,961\}</m></p></statement>
          <hint><p>Ce sont des carrés parfaits.</p></hint>
          <answer>
            <p>
              <m>
                 \{x\mid x=y^2 \text{ et } 1\leq y\leq 31\text{ et } y\in\mathbb{N}\}


              </m>
            </p>
          </answer>
        </task>
        <task>
           <statement><p><m>\{1,8,27,64,125,\ldots\}</m></p></statement>
          <hint><p>Ce sont des cubes parfaits.</p></hint>
          <answer>
            <p><m>\{x\mid x=y^3 \text{ et } y\in\mathbb{N^*}\}</m></p>
          </answer>
        </task>


      </example>

      <p>
        Notes or examples related to computation or technology can go in blocks
        of the same name.
      </p>

      <technology>
        <title>Sample Use of Sage</title>

        <p>
          This would be a good place to talk about Sage, including a cell or
          two.
        </p>

        <sage> <input>diff(x^4, x)</input> <output>4*x^3</output> </sage>

        <p>
          But you might want to describe how to use some other calculator, or
          maybe some numerical method.
        </p>
      </technology>

      <paragraphs>
        <title>
          A <tag>paragraphs</tag> with a <tag>project</tag> with an
          <tag>answer</tag>
        </title>

        <p>
          The solutions to a project (and similar) once did not migrate to the
          automatically-generated solutions.
        </p>

        <project>
           <statement>
            <p>A simple project, no tasks, just an answer.</p>
          </statement> <answer>
            <p>Here's the answer we are looking for.</p>
          </answer>
        </project>


      </paragraphs>


    </subsubsection>

    <exercises xml:id="exercises-subsection-solo">
       <exercise xml:id="exercise-test-number">
         <statement>
          <p>
            This is an exercise in an
            <q>Exercises</q>
             subdivision at the level of a subsubsection. There is no question
            other than if the numbering is appropriate. Here is a
            self-referential link: Exercise<nbsp /><xref
              ref="exercise-test-number"
            />.
          </p>

          <p>
            The subsubsection has no title in the source, so one is provided
            automatically, and will adjust according to the language of the
            document.
          </p>
        </statement>
        <solution>
          <p>
            This solution will migrate to a list of solutions in the backmatter.
            We include a <c>sidebyside</c> as a test.
          </p>
          <sidebyside permid="dEf" width="30%">
            <p>
              This is a skinny paragraph which should be just 30% of the width.
            </p>
            <p>
              And another skinny paragraph which should also be just 30% of the
              width.
            </p>
          </sidebyside>


        </solution>
      </exercise>

      <exercise xml:id="exercise-with-tasks">
         <introduction>
          <p>
            An <tag>exercise</tag> can be structured with parts, called
            <tag>task</tag>. This is the <tag>introduction</tag>.
          </p>
        </introduction> <task><p>Do this.</p></task> <task>
          <p>And the other thing.</p>
        </task>
      </exercise>


    </exercises>

    <reading-questions>
       <introduction>
        <idx>reading questions</idx>
        <p>
          A set of reading questions may have an <tag>introduction</tag>, perhaps
          for preparatory explanation.
        </p>
        <p>
          If a student has logged in to the HTML version, then they can answer
          the reading questions directly in the book. Inline math LaTeX can be
          entered using <c>$</c>...<c>$</c> or <c>\(</c>...<c> \) </c>
          delimiters, and inline AsciiMath using backticks <c>`</c>...<c> ` </c>
          as delimiters. Here are some `gratuitous backticks` to check that
          AsciiMath is only active in the answers to reading questions.
        </p>
      </introduction>

      <exercise xml:id="first-reading">
        <p>
          This is a <term>reading question</term> that you might have a student
          answer prior to a class session, based on reading part of the book. A
          quick glance before class can help you tailor class time to the
          specific needs of your students. The perfect reading question will
          reveal whether the student has read and understood the material, and
          will be difficult to answer if they have not. What do you think of
          that?
        </p>
      </exercise>

      <exercise>
        <p>
          And a second one, with a cross-reference to the first, as a check on
          numbering: <xref ref="first-reading" text="type-global" />. Reading questions
          are allowed to have answers, but providing answers misses the point of
          a reading question, and the answer knowl interacts poorly with the mechanism
          used to allow students to answer directly in the book. Do you think the
          schema should ban answers to reading questions?
        </p>
      </exercise>

      <conclusion><p>And for symmetry, a <tag>conclusion</tag>.</p></conclusion>


    </reading-questions>

    <glossary>
      <idx>glossary</idx><headnote>
        <p>
          A glossary may have a <tag>headnote</tag>, perhaps with some explanation.
        </p>
      </headnote>

      <gi>
        <title>bar</title>
        <p>
          A part of <term>foobar</term>. See <xref
            ref="foobar-defined"
            text="title"
          />.
        </p>
      </gi>

      <gi xml:id="foobar-defined">
        <title>foobar</title>
        <p>A synonym for the acronym <acro>FUBAR</acro>.</p>
      </gi>
    </glossary>

    <solutions
      xml:id="solutions-subsection"
      inline="hint solution answer"
      divisional="hint solution answer"
      project="hint solution answer"
    >
      <title>Solutions for This Subsection</title>
      <idx><h>solutions</h><h>for a division</h></idx>

      <introduction>
        <p>
          This is an introduction, where you might explain that this division of
          this subsection contains various hints, answers, solutions of inline
          exercises, divisional exercises, and/or project-like blocks. See the
          source to see just how this solutions division was built.
        </p>
      </introduction>

      <conclusion permid="deF">
        <p>
          And a conclusion to this solutions division, which may not be readily
          apparent as distinct from the final division's worth of solutions, but
          since it is not prefixed with a number, it may be different enough.
        </p>
      </conclusion>

    </solutions>
  </subsection>

  <subsection>
    <title>Theorem-Like Environments</title>

    <p>
      There are a variety of pre-defined environments in <pretext />. All take a
      title, and must have a statement. Some have proofs (theorems, corollaries,
      <etc />), while some do not have proofs (conjectures, axioms, principles).
    </p>

    <principle xml:id="principle-principle">
      <title>The Title Principle</title>

      <statement>
        <p>
          It is a fundamental principle that many elements can have a title. Try
          it and see. If you get better formatting, then it is being recognized.
          If it looks very plain, check the documentation and perhaps make a
          feature request.
        </p>
      </statement>
    </principle>

    <p>
      More precisely, <tag>theorem</tag>, <tag>corollary</tag>, <tag>lemma</tag>,
      <tag>algorithm</tag>, <tag>proposition</tag>, <tag> claim </tag>,
      <tag>fact</tag>, and <tag>identity</tag>, all behave exactly the same,
      requiring a statement (as a sequence of paragraphs) followed by an
      optional proof, and may have an optional title. The elements
      <tag>axiom</tag>, <tag>conjecture</tag>, <tag>principle</tag>, <tag>
         heuristic
      </tag>, <tag>hypothesis</tag>, and <tag>assumption</tag> are functionally the
      same, barring a proof (since they would never have one!). Definitions are an
      exception, as it is natural to place <tag>notation</tag> within<mdash />see
      the source for Definition<nbsp /><xref
        ref="definition-indefinite-integral"
      /> for an example.
    </p>
  </subsection>

  <subsection>
    <title>Linking Sage Cells</title>
    <idx><h>Sage cells</h><h>linking</h></idx>

    <p>
      Sage cells share their results on a per-webpage basis, or a per-knowl
      basis, so if you move to a new chapter, section, or subsection that
      happens to be on another webpage, your Sage computations are gone and you
      start fresh. But maybe you need some results from elsewhere. As an author,
      you can make an exact copy of a cell in another location by placing the
      code in an external file, which is pure text, freed from any need to
      format for XML processing. So, in particular, there is no need to escape
      ampersands and angle brackets, nor is there employment of the <c>CDATA</c>
      mechanism. But the real value is that there is just one version to edit,
      and any changes will be reflected in both copies. We demonstrate this in
      the sample book, since it has the <c>xinclude</c> mechanism in place. In
      the chapter on groups, find the section on Sage and then find the
      discussion of subgroups, and you will find an example of two identical
      Sage cells produced from one source file.
    </p>
  </subsection>

  <subsection>
    <title>Hierarchy</title>

    <paragraphs xml:id="hierarchy-structure">
      <title>Structure</title>

      <p>
        This section of this article has subsections and subsubsections. In a
        book you can have chapters enclosing multiple sections. There is one
        finer subdivision, it is achieved with the <c>paragraphs</c> element.
      </p>

      <p>
        It is basically a sequence of paragraphs, where the first one gets an
        inline title. You are reading the second, and final, paragraph of one
        right now. It is useful for organizing very short documents, where
        numbered subdivisions might be overkill.
      </p>
    </paragraphs>

    <paragraphs>
      <title>A Second Paragraphs</title>
      <p>
        This is a second consecutive <c>paragraphs</c> element, so should seem
        related to its title, but distinct from the two paragraphs in the
        grouping with the title
        <q>Structure</q>
         immediately prior.
      </p>
    </paragraphs>

    <assemblage permid="Ghi" xml:id="assemblage-basics">
      <title>Assemblages: Collections and Summaries</title>

      <p>
        An <tag>assemblage</tag> is a collection, or summary, that does not have
        much structure to it. So you are limited to paragraphs and friends (<c>
           p
        </c>, <c>blockquote</c>, <c>pre</c>) and side-by-sides that do not
        contain captioned items (<c>sidebyside</c>, <c>sbsgroup</c>). The intent
        is that contents are not numbered, so cannot be cross-referenced individually,
        and so also do not become knowls. You may place <tag>image</tag>,
        <tag>tabular</tag>, and <tag> program </tag> inside a <tag>
           sidebyside
        </tag>, in addition to other objects that do not have captions. Note
        that <c>p</c> may by extension contain lists (<c>ol</c>, <c>ul</c>, <c>
           dl
        </c>). Despite limited structure, the presentation should draw attention
        to it, because the contents should be seen as more important in some
        way. It should be
        <q>highlighted</q>
         in some manner. If you need to connect the entire assemblage with
        material elsewhere, you can do that with the usual <c>xref/xml:id</c>
        mechanism.<idx><h>assemblage</h></idx>
      </p>

      <p>
        What have we seen so far in this (disorganized) sample?
        <ul>
          <li>
            <p>
              Theorems, definitions and corollaries. (<xref
                ref="section-fundamental-theorem"
                text="type-global"
              />)
            </p>
          </li>
          <li>
            <p>
              Sage cells, including with R. (<xref
                ref="section-sage-cells"
                text="type-global"
              />)
            </p>
          </li>
          <li>
            <p>
              Lots of document structure, like introductions and conclusions
              (next). (<xref ref="interesting-corollary" text="type-global" />)
            </p>
          </li>
        </ul>
      </p>

      <p>
        A sample table, as a <c>tabular</c> inside a <c>sidebyside</c> with no
        caption, follows.
      </p>

      <tabular>
         <row><cell>A</cell><cell>B</cell><cell>C</cell></row> <row>
          <cell>Uno</cell><cell>Dos</cell><cell>Tres</cell>
        </row>
      </tabular>


    </assemblage>

    <assemblage>
      <p>
        This is a small <c>assemblage</c> with no title, simply to make sure the
        surrounding box behaves properly, especially for <latex /> output.
      </p>
    </assemblage>

    <assemblage>
      <title>
        Assemblages containing
        <m>\mu \forall \tau \mathbb{H} = \emptyset \kappa</m>
      </title>

      <p>
        It is acceptable for an assemblage to contain mathematical content, even
        in its title.
      </p>
    </assemblage>
  </subsection>

  <subsection xml:id="subsection-intro-conclude">
    <title>Introductions and Conclusions</title>

    <introduction>
      <title>An Introductory Introduction</title>

      <p>
        Any subdivision may have a sequence of paragraphs within an
        <tag>introduction</tag> that precedes subsequent further subdivisions.
        You are reading one now. They are always leaves of the document
        structure, so are rendered on some pages that reference the following
        subdivisions.
      </p>

      <p>
        An introduction or conclusion is an extremely restrictive container with
        simple presentation. A title is optional (and probably not advisable).
        Content is meant to be short and unstructured, in particular, nothing
        that can be numbered is allowed. If this feels <em>too</em> restrictive,
        then place your content in an initial numbered subdivision and perhaps
        title it
        <q>Introduction</q>
         . Or make your entire subdivion unstructured and place whatever you
        want into it.
      </p>

      <p>This ends this introduction to introductions.</p>
    </introduction>

    <subsubsection>
      <title>Test One</title>

      <p>An intervening subsubsection just after an introduction.</p>
    </subsubsection>

    <subsubsection>
      <title>Test Two</title>

      <p>
        An intervening subsection section which contains an <tag>exercises</tag>
        division which must be at the level of a Subsubsubsection.
      </p>
      <exercise>
         <statement>
          <p>
            An inline exercise to examine any clash with divisional exercises
            below.
          </p>
        </statement> <answer>
          <p>
            An answer so there is something to appear in a <tag>solutions</tag>.
          </p>
        </answer>
      </exercise>

      <reading-questions>
        <title>What Did You Learn?</title>
        <exercise>
           <statement><p>A mock exercise to appease validation.</p></statement> <answer>
            <p>
              An answer so there is something to appear in a
              <tag>solutions</tag>.
            </p>
          </answer>
        </exercise>
        <exercise>
           <statement>
            <p>And a second to help with formatting the division heading.</p>
          </statement>
        </exercise>


      </reading-questions>

      <exercises>
         <exercise>
           <statement><p>A mock exercise to appease validation.</p></statement> <answer>
            <p>
              An answer so there is something to appear in a
              <tag>solutions</tag>.
            </p>
          </answer>
        </exercise> <exercise>
           <statement>
            <p>And a second to help with formatting the division heading.</p>
          </statement>
        </exercise>
      </exercises>
    </subsubsection>

    <subsubsection>
      <title>Test Three</title>

      <p>An intervening subsubsection just before a conclusion.</p>
    </subsubsection>

    <conclusion>
      <p>
        Entirely analogous to introductions are conclusions. Any subdivision may
        have a sequence of paragraphs within a <tag>conclusion</tag> that
        follows previous further subdivisions. You are reading one now. They are
        always leaves of the document structure, so are rendered on some pages
        that reference the preceding subdivisions.
      </p>

      <p>
        This concludes this conclusion (and this subsection and this section).
      </p>
    </conclusion>
  </subsection>

  <subsection xml:id="subsection-paragraph-markup">
    <title>Some Paragraph-Level Markup</title>

    <p>
      Text within a paragraph may be <em>emphasized</em><idx>
        <h>em</h><h>emphasis</h>
      </idx><idx><h>styling words</h><h>em</h></idx><idx>
        <h>styling words</h><h>emphasis</h>
      </idx> with <tag>em</tag> or if you want to take it to the next level you can
      identify the text as an <alert>alert</alert><idx>alert</idx><idx>
        <h>styling words</h><h>alert</h>
      </idx> with <tag>alert</tag>.
    </p>

    <p>
      Similarly, within a paragraph, you can identify edits between versions as
      <insert>inserted text that has been added</insert><idx>
        <h>styling words</h><h>insert</h>
      </idx> with <tag>insert</tag> or as <delete>
         deleted text that has been removed
      </delete><idx><h>styling words</h><h>delete</h></idx> with
      <tag>delete</tag>. Note that these identified edits are slightly different
      than <stale>
         stale text that you want to retain, but which is no longer relevant
      </stale><idx><h>styling words</h><h>stale</h></idx>, which is accomplished
      with <tag>stale</tag>. The original request for stale text came from an
      instructor with an online list of student topics for presentations, and as
      students claimed topics they were marked as no longer available for other
      students.
    </p>

    <p>
      If you need a
      <q>fill-in blank</q>
       , like this<fillin />, it can be obtained with an empty
      <tag> fillin </tag> element that defaults to roughly a 10-character width.
      You can use the <tag>characters</tag> attribute to make the rule longer or
      shorter, such as a 40-character blank: <fillin characters="40" />. The character
      count is approximate, based on typical character widths within a proportional
      font carrying English language text. Adjust to suit, or request a language-specific
      adjustment if it is critical.
    </p>

    <p>
      Long after we started this mess, we added <pretext /> tags to mark up tags
      and attributes. The elements are: <tag>tag</tag>, <tag> tage </tag>,
      <tag>attr</tag>. Examples of how these render are (respectively): <tag>
         section
      </tag>, <tage>hash</tage>, <attr>width</attr>. Perhaps this document will
      make greater use of these tags.
    </p>

    <p>
      We supply two provisional cross-references for testing purposes only:
      <xref provisional="a first incomplete cross-reference" />, <xref
        provisional="a second incomplete cross-reference"
      />.
    </p>
  </subsection>

  <conclusion>
    <p>A conclusion here, which we fill with some numbering tests.</p>

    <p>
      This is a cross-reference to one of the outcomes, forced to use the
      <c>type-global</c> form of the text. It should describe the outcome as
      belonging to the <em>section</em> (rather than the <em>outcomes</em>), since
      outcomes are one-per-subdivision and are numbered based upon the containing
      division: <xref ref="outcome-structure" text="phrase-global" />. For
      comparison this is the (forced) <c>type-global</c> cross-reference:
      <xref ref="outcome-structure" text="type-global" />.
    </p>
  </conclusion>

  <outcomes xml:id="outcomes-structures">
    <title>Fundamental Structures, Revisited</title>

    <introduction>
      <p>
        This is a <tag>outcomes</tag> element you are reading, and this is its
        introduction. This early section has really grown and we have tried to
        accomplish many things. Not all of them are listed here.
      </p>
    </introduction>

    <ol permid="gHi">
      <li>
        Display various
        <q>blocks</q>
         , fundamental units of the flow.
      </li>
      <li xml:id="outcome-structure">
        More, and this is what the cross-references above are pointing to.
      </li>
      <li>Evermore.</li>
    </ol>

    <conclusion>
      <p>
        This concludes the (incomplete) outcomes for this section, so now we can
        carry-on to the next section.
      </p>
    </conclusion>
  </outcomes>
</section>

<section permid="Bcd">
  <title>Some Facts and Figures</title>
  <idx>footnotes</idx>

  <p>
    Because of the Fundamental Theorem<fn>First test footnote</fn>, for every
    derivative we know, there is an antiderivative we might find useful. Because
    of the Fundamental Theorem of Calculus<fn> Second test footnote </fn>, we
    recycle the
    <q><m>\int</m></q>
     symbol as notation for an antiderivative.
    <ul cols="2">
      <li>
        <p>
          Derivatives
          <ol label="(a)">
            <li><m>\frac{d}{dx}x^n = nx^{n-1}</m></li>
            <li><m>\frac{d}{dx}e^x = e^x</m></li>
            <li><m>\frac{d}{dx}\cos(x) = -\sin(x)</m></li>
          </ol>
        </p>
      </li>
      <li>
        <p>
          Antiderivatives
          <ol label="i)">
            <li>
              <m>
                 \indefiniteintegral{x^n}{x} = \displaystyle\frac{x^{n-1}}{n+1}\text{
                if }n\neq -1
              </m>
            </li>
            <li><m>\indefiniteintegral{e^x}{x} = e^x</m></li>
            <li><m>\indefiniteintegral{\sin(x)}{x} = -\cos(x)</m></li>
          </ol>
        </p>
      </li>
    </ul>
  </p>

  <remark>
    <p>
      You can<fn>Third test footnote</fn> gain a greater understanding of derivatives
      by studying the graphs of functions with their derivatives. Can<fn>
         Fourth test footnote
      </fn>
      you discern the derivative<ndash />antiderivative<fn>
         Fifth test footnote
      </fn> relationship in Figure<nbsp /><xref
        ref="figure-function-derivative"
      />?
    </p>
  </remark>

  <figure xml:id="figure-function-derivative">
    <caption>A function and its derivative</caption><image
      width="50%"
      source="images/cubic-function.png"
    >
      <description>
        A third degree polynomial with a local max and a local min, along with
        its second degree derivative plotted on the same axes
      </description>
    </image>
  </figure>

  <p>
    Lists<fn>Sixth test footnote</fn> can have multiple columns. With <init>
       HTML
    </init> items displayed in row-major order (horizontally first) and<fn>
       Seventh test footnote
    </fn>
    with <latex /> items are displayed in column-major order (vertically first).
    When one order, or the other, becomes workable in both variants, maybe we
    will be consistent in presentation. (Note that with just one row, it makes
    no difference.) We used it above for the two items<mdash />derivatives and
    integrals<mdash />where each item was a list of its own. Here are two more
    examples, one with short snippets and lots of columns, the other with lots
    of text in paragraphs.<idx
      xml:id="index-start-multicolumn"
      finish="index-finish-multicolumn"
    ><h>list</h><h>multicolumn</h></idx>
    <ol cols="5">
      <li><p>Red</p></li>
      <li><p>Blue</p></li>
      <li><p>Green</p></li>
      <li><p>Purple</p></li>
      <li><p>Yellow</p></li>
      <li><p>Black</p></li>
      <li><p>Orange</p></li>
      <li><p>Pink</p></li>
      <li permid="bCd">
        <p permid="bcD">Salmon<idx><h>strange colors</h></idx></p>
      </li>
      <li><p>Aqua</p></li>
      <li><p>Cyan</p></li>
      <li><p>Puce<idx><h>strange colors</h></idx></p></li>
    </ol>
    <ul cols="2">
      <li>
        <p>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin lorem
          diam, convallis in nulla sed, accumsan fermentum urna. Pellentesque
          aliquet leo elit, ut consequat nunc dapibus ac. Sed lobortis leo
          tincidunt, vulputate nunc at, ultricies leo. Vivamus purus diam,
          tristique laoreet purus eget, mollis gravida sapien. Nunc vulputate
          nisl ac mauris hendrerit cursus. Sed vel molestie velit. Suspendisse
          sem sem, elementum at vehicula id, volutpat ac mi. Nullam ullamcorper
          fringilla purus in accumsan. Mauris at nunc accumsan orci dictum
          vulputate id id augue. Suspendisse at dignissim elit, non euismod
          nunc. Aliquam faucibus magna ac molestie semper. Aliquam hendrerit sem
          sit amet metus congue tempor. Donec laoreet laoreet metus, id interdum
          purus mattis vulputate. Proin condimentum vitae erat varius mollis.
          Donec venenatis libero sed turpis pretium tempor.
        </p>

        <p>
          Praesent rutrum scelerisque felis sit amet adipiscing. Phasellus in
          mollis velit. Nunc malesuada felis sit amet massa cursus, eget
          elementum neque viverra. Integer sagittis dictum turpis vel aliquet.
          Fusce ut suscipit dolor, nec tristique nisl. Aenean luctus, leo et
          ornare fermentum, nibh dui vulputate leo, nec tincidunt augue ipsum
          sed odio. Nunc non erat sollicitudin, iaculis eros consequat, dapibus
          eros.
        </p>
      </li>

      <li>
        <p>
          Donec vestibulum auctor nisl. Nullam placerat interdum dui. Quisque
          lobortis scelerisque augue imperdiet placerat. Maecenas ultricies
          massa tempor, laoreet urna a, eleifend enim. Integer sed suscipit
          odio. Pellentesque non dapibus diam, eget tempus dui. Maecenas
          sollicitudin magna viverra, egestas velit nec, tristique sem. Cras
          iaculis mattis dui ac cursus. Integer volutpat, urna vel tempus
          convallis, erat nisi consectetur turpis, id varius dolor lorem vitae
          mauris. Phasellus erat orci, laoreet commodo gravida quis, congue in
          lacus. Cum sociis natoque penatibus et magnis dis parturient montes,
          nascetur ridiculus mus. Praesent at bibendum turpis. Pellentesque est
          nisl, dapibus at sagittis non, ultricies in nunc. Etiam ipsum arcu,
          porta sed feugiat eget, facilisis nec libero. Mauris tempor convallis
          felis.
        </p>

        <p>
          Cras iaculis sapien elit, at convallis ligula convallis nec. Duis ante
          tortor, euismod a libero vitae, ornare viverra purus. Pellentesque
          facilisis urna a velit volutpat, in malesuada tortor porttitor. Sed
          vehicula mauris id lectus dignissim, eget consectetur dui
          pellentesque. Sed vel quam molestie, euismod ligula ac, venenatis
          arcu. Fusce sit amet sapien non urna dignissim tempus in vitae metus.
          Aliquam arcu turpis, mattis non libero eu, lacinia feugiat turpis.
          Phasellus rhoncus lacinia lacus facilisis ullamcorper. Praesent
          hendrerit accumsan neque, eu dignissim est consequat sed. Nulla
          facilisi. Proin at mi scelerisque, scelerisque felis ut, tristique
          diam. Proin in leo in lorem porttitor varius. Praesent condimentum in
          dui sit amet blandit. In imperdiet blandit congue.
        </p>
      </li>

      <li>
        <p>
          Ut nec sem vitae ipsum interdum vestibulum sit amet sed velit. Aliquam
          tempor nibh vitae augue pulvinar, at ultricies urna commodo. Donec in
          porta lectus, ac sagittis felis. Vestibulum tincidunt quis metus
          facilisis luctus. In lobortis lacus vel ornare vehicula. Duis aliquet,
          ligula semper sodales adipiscing, augue nibh ornare ante, quis
          pulvinar justo mi eget mi. Mauris varius imperdiet vehicula. Duis
          dignissim magna quis velit mattis, in cursus lectus vehicula. Morbi
          quis tempus felis, ut gravida nisi.
        </p>

        <p>
          Vivamus eu commodo est, pretium fringilla dolor. Curabitur vel
          sollicitudin libero. Integer sit amet auctor felis. Maecenas sagittis
          erat at ante feugiat, in tincidunt ligula pretium. Integer eget auctor
          ipsum, quis volutpat felis. Morbi id dignissim eros. Suspendisse
          aliquet pulvinar lorem gravida egestas. Cum sociis natoque penatibus
          et magnis dis parturient montes, nascetur ridiculus mus. Praesent nec
          massa dui. Suspendisse convallis lacus sit amet adipiscing varius.
          Suspendisse tempus diam vitae justo ornare, in condimentum metus
          pharetra. Curabitur sem dolor, auctor vitae sagittis vestibulum,
          posuere imperdiet metus. Etiam pretium lacus urna, vel auctor diam
          tincidunt non. Etiam viverra sodales iaculis.
        </p>
      </li>

      <li>
        <p>
          Sed varius leo urna. Phasellus tempus mollis ultricies. Curabitur non
          neque aliquet, facilisis tortor in, sodales dui. Donec hendrerit
          ultricies nulla mollis rhoncus. In vel lobortis est. Vestibulum
          consectetur lacus vel sem dignissim vestibulum. Etiam sed elementum
          ligula, vel congue turpis. Morbi nec diam mattis, venenatis eros et,
          elementum tellus. Integer sed orci ornare, elementum elit id, lacinia
          augue. Vestibulum ante ipsum primis in faucibus orci luctus et
          ultrices posuere cubilia Curae; In et libero id turpis pharetra
          faucibus. Integer consequat dignissim semper. Donec pretium magna at
          ullamcorper ultricies. Nam quis suscipit elit. Donec cursus tellus et
          venenatis feugiat. Mauris dictum molestie leo, vitae aliquet metus
          luctus vitae.
        </p>

        <p>
          Ut id iaculis leo. Sed nec vestibulum mi. Mauris est mauris, porta in
          nulla eget, bibendum luctus nisl. Praesent et posuere felis, molestie
          vehicula velit. Nulla a nunc venenatis, aliquam orci nec, congue
          felis. Vestibulum a dolor nisi. Morbi sed nisi nulla. Nam iaculis
          felis a enim blandit, at venenatis diam congue. Nulla augue diam,
          egestas eget fermentum nec, posuere eget risus. Praesent egestas nulla
          eros, eget accumsan augue euismod vel. Pellentesque pellentesque non
          erat vitae posuere. Curabitur lacus arcu, varius sed risus ut,
          ullamcorper tincidunt lorem. Sed et lacus dignissim, tincidunt nisl
          ac, porttitor sapien.
        </p>
      </li>
    </ul>
  </p>
</section>

<section>
  <title>Some Advanced Ideas</title>

  <p>
    <idx xml:id="index-finish-multicolumn" start="index-start-multicolumn" />The
    multi-row displayed mathematics in the proof of the Fundamental Theorem had equations
    aligned on the equals signs via the & character. Sometimes you don't want that.
    Here is an example with some differential equations, with each equation centered
    and unnumbered,<md>
       <mrow>
         {\mathcal L}(y')(s) = s {\mathcal L}(y)(s) - y(0) = s Y(s) - y(0)
      </mrow> <mrow>
         {\mathcal L}(y'')(s) = s^2 {\mathcal L}(y)(s) - sy(0) - y'(0)= s^2 Y(s)
        - sy(0) - y'(0)
      </mrow>
    </md>. <notation>
       <usage><m>\rho</m></usage><description>
        this symbol could be used for lots of things, but we are just trying to
        make a super-long description to get it to wrap within the column where
        it belongs, which is sometimes set to a fixed width to accomodate really
        complicated explanations
      </description>
    </notation><idx>rho, a test</idx> Just prior to this sentence, in the middle
    of this paragraph, is an <tag>idx</tag> and a <tag>notation</tag>, adjacent,
    but separated by some whitespace in the authored source. That insignificant whitespace
    will be removed akways, which will be a (slightly) noticeable improvement in
    the <latex /> output. We test referencing notation here, placed <em>
      before
    </em> the sentence-ending period and right after some inline mathematics<mdash />for
    <m>\mathbb{Z}_n</m><notation>
       <usage><m>\mathbb{Z}_n</m></usage><description>
        (ring of) integers modulo <m>n</m>
      </description>
    </notation>.
  </p>

  <p>
    <latex /> has a device where you can interrupt a sequence of equations with
    a small amout of text and preserve the equation alignment on either side.
    Here are two tests of that device, with aligned equations and non-aligned
    equations. Study the source to see use and differences. (The math does not
    make sense.)
  </p>

  <p>
    Aligned and numbered first.<mdn>
       <mrow>
         {\mathcal L}(y')(s) &= s {\mathcal L}(y)(s) - y(0) = s Y(s) - y(0)
      </mrow> <mrow>
         {\mathcal L}(y'')(s) &= s^2 {\mathcal L}(y)(s) - sy(0) - y'(0)= s^2 Y(s)
        - sy(0) - y'(0).
      </mrow> <intertext>And so it follows that,</intertext> <mrow>
         {\mathcal L}(y')(s)^{++} &= s {\mathcal L}(y)(s) - y(0) = s Y(s) - y(0)


      </mrow> <mrow>
         {\mathcal L}(y'')(s)^{5} &= s^2 {\mathcal L}(y)(s) - sy(0) - y'(0)= s^2
        Y(s) - sy(0) - y'(0).
      </mrow>
    </mdn>
  </p>

  <p>
    Now with no numbers and no alignment. We include two cross-references in the
    <c>intertext</c> portion for testing.<md>
       <mrow>
         {\mathcal L}(y')(s) = s {\mathcal L}(y)(s) - y(0) = s Y(s) - y(0)
      </mrow> <mrow>
         {\mathcal L}(y'')(s) = s^2 {\mathcal L}(y)(s) - sy(0) - y'(0)= s^2 Y(s)
        - sy(0) - y'(0).
      </mrow> <intertext>
         First an external reference to <url
          href="http://example.com"
          visual="example.com"
        /> and internal cross-reference to <xref
          ref="corollary-FTC-derivative"
          text="type-global"
        />. And so it follows that,
      </intertext> <mrow>
         {\mathcal L}(y')(s)^{++} = s {\mathcal L}(y)(s) - y(0) = s Y(s) - y(0)
      </mrow> <mrow>
         {\mathcal L}(y'')(s)^{5} = s^2 {\mathcal L}(y)(s) - sy(0) - y'(0)= s^2 Y(s)
        - sy(0) - y'(0)
      </mrow>
    </md>.
  </p>

  <p>
    Tables can get quite complex. Simple ones are simpler, such as this example
    of numerical computations for Euler's method in just a bit.
  </p>

  <p>
    But first we make a figure with two very simple tables next to each other.
    This causes the very first instance of <tag>table</tag> to actually be a
    <q>subtable</q>
     , which exposes a bug provoked by Emiliano Vega and fixed around
    2020-08-06. (So we have to place this early to create the same behavior that
    exposed the bug.)
  </p>

  <figure>
    <caption>Buggy sub-tables</caption>

    <sidebyside>
       <table>
        <title>First</title>
        <tabular> <row><cell>One</cell></row> </tabular>
      </table> <table>
        <title>Second</title>
        <tabular> <row><cell>Two</cell></row> </tabular>
      </table>
    </sidebyside>
  </figure>

  <table xml:id="table-euler1">
    <title>
      Euler's approximation for Duffing's Equation with <m>h = 0.2</m>
    </title>
    <tabular top="major" halign="center">
       <row bottom="minor">
        <cell><m>i</m></cell><cell><m>t_i</m></cell><cell><m>x_i</m></cell><cell><m>
             y_i
          </m></cell>
      </row> <row>
        <cell>0</cell><cell>0.00</cell><cell>0.0000</cell><cell>0.5000</cell>
      </row> <row>
        <cell>1</cell><cell>0.20</cell><cell>0.1000</cell><cell>0.4800</cell>
      </row> <row>
        <cell>2</cell><cell>0.40</cell><cell>0.1960</cell><cell>0.4560</cell>
      </row> <row>
        <cell>3</cell><cell>0.60</cell><cell>0.2872</cell><cell>0.4295</cell>
      </row> <row>
        <cell>4</cell><cell>0.80</cell><cell>0.3731</cell><cell>0.4027</cell>
      </row> <row>
        <cell>5</cell><cell>1.00</cell><cell>0.4536</cell><cell>0.3783</cell>
      </row> <row>
        <cell>6</cell><cell>1.20</cell><cell>0.5293</cell><cell>0.3591</cell>
      </row> <row>
        <cell>7</cell><cell>1.40</cell><cell>0.6011</cell><cell>0.3480</cell>
      </row> <row>
        <cell>8</cell><cell>1.60</cell><cell>0.6707</cell><cell>0.3474</cell>
      </row> <row>
        <cell>9</cell><cell>1.80</cell><cell>0.7402</cell><cell>0.3603</cell>
      </row> <row bottom="medium">
        <cell>10</cell><cell>2.00</cell><cell>0.8123</cell><cell>0.3900</cell>
      </row>
    </tabular>


  </table>
</section>

<section>
  <title>Mathematics</title>

  <introduction>
    <p>
      To be able to create both <latex /> and HTML output (plus variations), we
      rely on MathJax, which in turn supports an extensive subset of the
      mathematical symbols normally available. The AMSMath symbol set is a good
      approximation. The <pretext /> Guide has a link to the complete list of
      macros supported by MathJax. We load the <c>AMSsymbols</c> library and the
      library for extensible arrows, <c>extpfeil</c>.
    </p>
  </introduction>

  <subsection>
    <title>Basic Mathematics</title>

    <p>
      The following is from the MathJax
      <url
        href="http://www.mathjax.org/demos/tex-samples/"
        visual="www.mathjax.org/demos/tex-samples/"
      >demonstration page</url>, an identity due to Ramanujan:<me>
         \frac{1}{\Bigl(\sqrt{\phi \sqrt{5}}-\phi\Bigr) e^{\frac25 \pi}} = 1+\frac{e^{-2\pi}}
        {1+\frac{e^{-4\pi}} {1+\frac{e^{-6\pi}} {1+\frac{e^{-8\pi}} {1+\ldots} }
        } }
      </me>
    </p>

    <p>
      And again, from the MathJax demonstration page, Maxwell's equations:<idx>
        Maxwell's equations
      </idx><md>
         <mrow>
           \nabla \times \vec{\mathbf{B}} -\, \frac1c\, \frac{\partial\vec{\mathbf{E}}}{\partial
          t} & = \frac{4\pi}{c}\vec{\mathbf{j}}
        </mrow> <mrow>\nabla \cdot \vec{\mathbf{E}} & = 4 \pi \rho</mrow> <mrow>
           \nabla \times \vec{\mathbf{E}}\, +\, \frac1c\, \frac{\partial\vec{\mathbf{B}}}{\partial
          t} & = \vec{\mathbf{0}}
        </mrow> <mrow>\nabla \cdot \vec{\mathbf{B}} & = 0</mrow>
      </md><notation>
         <usage><m>\nabla</m></usage><description>
          gradient operator
        </description>
      </notation>
    </p>

    <p>
      A small test that the extensible arrows library is included properly:<me>A\xmapsto[\text{bijection}]{\Phi+\Psi+\Theta}B</me>
    </p>

    <p>
      Look back at the top of the source file of this document to see how to
      include your <tex /> macros just once. For best results keep your macros
      simple and semantic.
    </p>

    <p>
      Chris Hughes has made available
      <q>slanted</q>
       , or
      <q>beveled</q>
       , or
      <q>nice</q>
       fractions. To wit, we mean fractions such as: <m>\sfrac{3}{8}</m>. Use the
      built-in <c>\sfrac{}{}</c> macro in your mathematics to achieve this presentation.
    </p>

    <p>
      We consider a system of equations. We number the first and last equation
      (there are just two) and include an <c>xml:id</c> on each. We reference
      the whole system later as the range of equations from the first to the
      last.<mdn> <mrow xml:id="equation-system-begin">
           \frac{dx}{dt} \amp = x^2 - 4x - y + 4
        </mrow> <mrow xml:id="equation-system-end">
           \frac{dy}{dt} \amp = x^3 - y.
        </mrow> </mdn>
    </p>
  </subsection>

  <subsection>
    <title>Displayed Mathematics</title>

    <p>
      Multi-line displays of mathematics are achieved with the <c>md</c> tag (
      <q>math display</q>
       ), and the variant that produces numbers on each line, <c>mdn</c> (
      <q>math display numbered</q>
       ), used within a paragraph (<c>p</c>). As a good example of how XML
      syntax is superior, you author <m>n</m> lines of equations by enclosing
      each line inside of a <c>mrow</c> tag, rather than using <m>n-1</m>
      separators (such as <c>\\</c>).
    </p>

    <p>
      If you use no ampersands to express alignment (read ahead), then each
      equation is centered independently on the width of the text. This is
      implemented according to the AMSmath <latex /> package's <c>gather</c>
      environment. Example:<md> <mrow> \frac{dx}{dt} = x^2 - 4x - y + 4 </mrow> <mrow>
           \frac{dy}{dt} = x^3 - y.
        </mrow> </md>
    </p>

    <p>
      An ampersand is used, in two ways, to describe positioning several
      equations per line, organized in columns. We have created the pre-defined
      <latex /> macro <c>\amp</c> as one way specify these, but the escape
      sequence <c>&amp;amp;</c> may be used also. The second, fourth, sixth,
      <ellipsis /> ampersands separate columns, and the spacing between columns
      will be provided automatically. The first, third, fifth, <ellipsis />
      ampersands are alignment points for the equations in each column.
      Typically this is placed just prior to a binary operator, such as an equal
      sign (<c>\amp = </c>), or for a column of explanations or commentary, just
      prior to the <c>\text{}</c> macro. Note that this scenario suggests always
      having an odd number of ampersands in each <c>mrow</c>. In the example below,
      alignment is on the equals sign in the first two columns, and provides left-justification
      to the explanations in the third column. N.B.: the use below of the <c>
         \text{}
      </c> macro does not include mathematics within its argument. Doing so may yield
      unpredictable results depending on your choice of delimiters for the mathematics
      (and using an <c>m</c> tag will be ineffective).<md>
         <mrow>
           \frac{dx}{dt} \amp = x^2 - 4x - y + 4 \amp \frac{dy}{dt} \amp = x^3 -
          y \amp\amp x, y\text{ version}
        </mrow> <mrow>
           \frac{dw}{dt} \amp = z^3 - w \amp \frac{dz}{dt} \amp = z^2 - 4z - w +
          4 \amp\amp z, w\text{ version}
        </mrow>
      </md>
    </p>

    <p>
      <pretext /> will automatically detect the presence or absence of
      ampersands, but by defining macros for entire aligned equations, you can
      effectively hide the ampersands. So the <c>@alignment</c> attribute can
      override automatic detection. We use a simple <latex /> macro to
      demonstrate setting <c>alignment='align'</c> to override the use of a
      <c>gather</c> environment and use a <c>align</c> environment instead.
      Example:<md alignment="align"> <mrow>
           \myequation{\frac{dx}{dt}}{x^2 - 4x - y + 4}
        </mrow> <mrow>\myequation{\frac{dy}{dt}}{x^3 - y}.</mrow> </md>
    </p>

    <p>
      The AMSmath <latex /> package's <c>alignat</c> environment is a third
      variant of alignment. It never happens automatically, you need to ask for
      it with <c>alignment="alignat"</c>. It is very similar to <c> align </c> but
      adds no space between the equation columns. So you can leave it that way, or
      you can add your own
      <q>extra</q>
       space to suit. Here is a previous example with no inter-column space:<md
        alignment="alignat"
      >
         <mrow>
           \frac{dx}{dt} \amp = x^2 - 4x - y + 4 \amp \frac{dy}{dt} \amp = x^3 -
          y \amp\amp x, y\text{ version}
        </mrow> <mrow>
           \frac{dw}{dt} \amp = z^3 - w \amp \frac{dz}{dt} \amp = z^2 - 4z - w +
          4 \amp\amp z, w\text{ version}
        </mrow>
      </md>. This modified example has a middle row with three columns, while the
      other rows have just one column, as a test of our routines for determining
      the <c>mrow</c> with the greatest number of ampersands (and how many there
      are),<md alignment="alignat">
         <mrow>\frac{dw}{dt} &= z^3 - w</mrow> <mrow>
           \frac{dx}{dt} &= x^2 - 4x - y + 4 & \frac{dy}{dt} &= x^3 - y&amp;& x,
          y\text{ third column}
        </mrow> <mrow>\frac{dw}{dt} & = z^3 - w</mrow>
      </md>. Final example demonstrates that ampersands in other objects (matrices
      here) can wreak havoc with computing the number of columns. So we provide yet
      another attribute to override automatic detection, <c>
         alignat-columns
      </c>. This is the number of <em>columns</em> not the number of
      <em>ampersands</em>. Generally, for <m>c</m> columns, there will be <m>
         2c-1
      </m> ampersands.<md alignment="alignat" alignat-columns="2">
         <mrow>
           A &= \begin{bmatrix}1 & 2 \\ 3 & 4\end{bmatrix} & I &= \begin{bmatrix}1
          & 0 \\ 0 & 1\end{bmatrix}
        </mrow>
      </md>. One caveat: if your number of ampersands is even (see advice above about
      using an odd number) behavior should still be correct, as in next example.
    </p>

    <p>
      If you want super-precise control over alignment of the terms of a system
      of equations (linear or not) you can use the <c>alignat</c> option to
      advantage by not including any extra space. This example is modified
      slightly from a post by Alex Jordan:<md alignment="alignat">
         <mrow>
           2x \amp {}+{} \amp y \amp {}+{} \amp 3z \amp {}={} \amp 10
        </mrow> <mrow>x \amp \amp \amp {}+{} \amp z \amp {}={} \amp 6</mrow> <mrow>
           x \amp {}+{} \amp 3y \amp {}+{} \amp 2z \amp {}={} \amp 13.
        </mrow>
      </md>Beautiful.
    </p>

    <p>
      A long equation, to check layout on various screen sizes. This is Weil's
      <q>explicit formula</q>
       for the Riemann <m>\zeta</m>-function: <men>
         \sum_\gamma S_-(\gamma) = \frac{\log Q}{\pi} \hat S_-(0) + \frac{1}{2\pi}
        \sum_{j=1}^d \Re\left\{ \int_{-\infty}^\infty \frac{\Gamma'}{\Gamma}\left(\frac{1}{4}
        + \frac{it}{2} + \mu_j\right)S_-(t) dt\right\} - \frac{d}{2\pi}\hat S_-(0)\log
        \pi
      </men>.
    </p>
    <example>
      <title>Excessive Display Mathematics</title>

      <p>
        In print versions, a long run of displayed equations often needs to be
        broken across pages. If you are reading some other version of this, then
        there is nothing to see here. But for <latex /> output it could be
        interesting. First, with no extra effort, this page-long display should
        break naturally, no matter how the preceding material changes.<md
          number="yes"
        >
           <mrow>x^2+y^2=z^2</mrow> <mrow>a^2+b^2=c^2</mrow> <mrow>
             \alpha^2+\beta^2=\gamma^2
          </mrow> <mrow>m^2+n^2=p^2</mrow> <mrow> x^2+y^2=z^2 </mrow> <mrow>
             a^2+b^2=c^2
          </mrow> <mrow> \alpha^2+\beta^2=\gamma^2 </mrow> <mrow>
             m^2+n^2=p^2
          </mrow> <mrow> x^2+y^2=z^2 </mrow> <mrow>a^2+b^2=c^2</mrow> <mrow>
             \alpha^2+\beta^2=\gamma^2
          </mrow> <mrow>m^2+n^2=p^2</mrow> <mrow> x^2+y^2=z^2 </mrow> <mrow>
             a^2+b^2=c^2
          </mrow> <mrow> \alpha^2+\beta^2=\gamma^2 </mrow> <mrow>
             m^2+n^2=p^2
          </mrow> <mrow> x^2+y^2=z^2 </mrow> <mrow>a^2+b^2=c^2</mrow> <mrow>
             \alpha^2+\beta^2=\gamma^2
          </mrow> <mrow>m^2+n^2=p^2</mrow> <mrow> x^2+y^2=z^2 </mrow> <mrow>
             a^2+b^2=c^2
          </mrow> <mrow> \alpha^2+\beta^2=\gamma^2 </mrow> <mrow>
             m^2+n^2=p^2
          </mrow> <mrow> x^2+y^2=z^2 </mrow> <mrow>a^2+b^2=c^2</mrow> <mrow>
             \alpha^2+\beta^2=\gamma^2
          </mrow> <mrow>m^2+n^2=p^2</mrow> <mrow> x^2+y^2=z^2 </mrow> <mrow>
             a^2+b^2=c^2
          </mrow> <mrow> \alpha^2+\beta^2=\gamma^2 </mrow> <mrow>
             m^2+n^2=p^2
          </mrow> <mrow> x^2+y^2=z^2 </mrow> <mrow>a^2+b^2=c^2</mrow> <mrow>
             \alpha^2+\beta^2=\gamma^2
          </mrow> <mrow>m^2+n^2=p^2</mrow> <mrow> x^2+y^2=z^2 </mrow> <mrow>
             a^2+b^2=c^2
          </mrow> <mrow> \alpha^2+\beta^2=\gamma^2 </mrow> <mrow>
             m^2+n^2=p^2
          </mrow> <mrow> x^2+y^2=z^2 </mrow> <mrow>a^2+b^2=c^2</mrow> <mrow>
             \alpha^2+\beta^2=\gamma^2
          </mrow> <mrow>m^2+n^2=p^2</mrow> <mrow> x^2+y^2=z^2 </mrow> <mrow>
             a^2+b^2=c^2
          </mrow> <mrow> \alpha^2+\beta^2=\gamma^2 </mrow> <mrow>
             m^2+n^2=p^2
          </mrow>
        </md>.
      </p>
      <p>
        So. Do not take any extra steps and let <latex /> figure out the breaks.
        If you do not like a break, modify the <c>md</c> or <c>mdn</c> to go
        back to the AMSmath default behavior and not break at all. Ever. Or
        rather, go further and modify an individual <c>mrow</c> to suggest that
        it is a good place for a break.
      </p>
    </example>

    <p permid="Cde">
      This is a poorly-authored paragaph to test the conversion to
      <init>HTML</init>. There are two displayed equations, separated by a period
      ending the first one's sentence, which should migrate into the display, and
      not leave behind an empty paragraph: <me permid="Fgh"> z+y = z </me>.
      <me>a + b = c</me>. This final sentence should remain, inside another <init>
         HTML
      </init> paragraph, without the second equation's period.
    </p>
  </subsection>

  <subsection>
    <title><latex /> Packages and MathJax Extensions</title>

    <p>
      If you would like to use macros from a <latex /> package <em>and</em>
      there is a MathJax extension <em>of the same name</em> which implements
      the same macros, then you may use these with your mathematics as we
      demonstrate here.
    </p>

    <p>
      This example is from Jason Underdown.<idx><h>Underdown, Jason</h></idx> The
      package is named <c>cancel</c> and is included in the TeXLive distribution,
      so is fairly standard. The particular macro being demonstrated is <c>
         \cancelto{}{}
      </c>.
      <me>
         \lim_{b \rightarrow \infty}\left[\cancelto{0}{-\frac{1}{s}e^{-sb}} + \frac{1}{s}\right]


      </me>. Look at the source of this article to see the package name being supplied
      in a <c>latex-preamble/package</c> element within the <c> docinfo </c> section.
      That is the only setup required to make the macro usable in <latex /> and <init>
         HTML
      </init> output.<idx><h>canceling a term</h></idx><idx sortby="cancelto macro"><c>
           cancelto
        </c>
        macro</idx>
    </p>

    <p>
      The packages appear before the author-supplied macros, so you can use
      macros from the packages as building blocks for document-specific macros.
      We cannot guarantee there will be no conflicts between additional packages
      and those in use normally, or added in the future. So use at your own
      risk.
    </p>
  </subsection>

  <subsection>
    <title>Advanced Mathematics</title>

    <p>
      MathJax is extremely capable in rendering a subset of <latex /> in web
      browsers, and improving all the time. You can get fairly fancy with some
      of its supported commands. In particular, if you need to mix in a few
      words with your mathematics, the <c>\text{}</c> macro is supported. For
      example, you might use an
      <q>if</q>
       or an
      <q>otherwise</q>
       in the definition of a piecewise function.
    </p>

    <p>
      Consider that the first line below is text sandwiched in-between two Greek
      letters, wrapped in a <c>\text{}</c> macro. In HTML output we have taken
      care that the font for text material within display mathematics should
      match the font of the surrounding paragraph, as also happens with
      <latex /> output. The second line is nearly identical in the source, but
      is just naked text being rendered like a slew of variables.<md>
         <mrow>\alpha\text{ is not equal to }\beta</mrow> <mrow>
           \alpha is not equal to \beta
        </mrow> <mrow>\alpha\neq\beta</mrow>
      </md>. We are not suggesting here that using words in place of symbols, as
      in the first line, is a good practice. (It is not.)
    </p>

    <p>
      The following example is a good stress-test of using the <c>\text{}</c>
      macro to achieve certain effects. Note the Unicode left and right smart
      quotes. This a contribution from Alex Jordan as part of his work on
      <pubtitle>APEX Calculus</pubtitle>
       .<md>
         <mrow>
           y \rightarrow \frac{\sin(0) }{0} \rightarrow {{\text{“}}\atop{}}\frac{0}{0}{{\text{”}}\atop{}}\text{.}


        </mrow>
      </md>And another one from Alex. Note the use of the <c>\mathord{}</c> and
      <c>\mathrel{}</c> macros to control spacing around the mathematical
      symbols. Examine the source to see how the quotation marks have been
      authored with <init>XML</init> syntax for Unicode characters, since we do
      not allow most markup inside mathematics.<md>
         <mrow>
           \zeta(1)=\sum_{n=1}^{\infty}\frac{1}{n}\mathrel{\text{ “}\mathord{=}{\text{”
          }}}\prod_{p}\left(\frac{1}{1-1/p}\right)=\prod_{p}\left(\frac{1}{1-p^{-1}}\right)


        </mrow>
      </md>
    </p>

    <p>
      Generally, you cannot use any <init>XML</init> elements inside of the
      mathematics elements. An exception is the <c>xref</c> element which you
      might want to use to provide justifications for the steps of a derivation.
      Here is a visual example that is mathematically meaningless,<md>
         <mrow>
           A&amp;=B+C&amp;&<xref
            ref="corollary-FTC-derivative"
            text="type-global"
          />


        </mrow> <mrow>
           &amp;=D+E&amp;&<xref ref="theorem-FTC" text="title" />
        </mrow> <mrow>
           &amp;=F+G&amp;&<xref ref="theorem-number-01" text="custom">
             A nice result
          </xref>


        </mrow>
      </md>.
    </p>

    <p>
      Scott Beaver likes to write short chains of equalities all in one line,
      with the cross-references sitting on each equals sign. Here we test the
      <latex /> <c>\overset</c> and <c>\underset</c> macros wrapping a
      <pretext /> <tag>xref</tag>, with and without content, inside an <tag>
         me
      </tag> element. Note that <c>\stackrel</c> is obsolete, and <c>
         \overunderset
      </c> is not yet supported by MathJax (but see <url
        href="https://github.com/mathjax/MathJax/issues/2704"
        visual="github.com/mathjax/MathJax/issues/2704"
      >GitHub #2704</url>). The mathematics is Scott's, the reasons are totally
      unrelated to the math.
      <me>
         AC-AD \overset{<xref ref="theorem-FTC" text="global" />}{=} A(C-D) \underset{<xref
          ref="definition-indefinite-integral"
          text="global"
        />}{=} A0_{n\times p} \overset{<xref ref="theorem-FTC" text="global">
           Thm.
        </xref>}{=} 0_{m\times p}
      </me>
      We suggest using cross-references that only display numbers (<tag>
         xref
      </tag> with <attr>text</attr> set to <c>global</c>) since if you stick to
      elements like <tag>theorem</tag>, <tag>lemma</tag>, <tag>definition</tag>,
      or <tag>axiom</tag>, then the numbers will be unambiguous and the target
      of the cross-reference will contain full information. But note that if you
      mix in divisions, or perhaps figures, as reasons then there is a
      possibility that numbers will need to be qualified by their type. We have
      provided an abbreviation for one cross-reference to
      <xref ref="theorem-FTC" text="type-global" /> (which will not benefit from
      automatic translation to other languages).
    </p>
  </subsection>

  <subsection>
    <title>Local Tags on Equations</title>

    <p>
      If you are not writing a research monograph, maybe (a) you will not use
      many numbered equations, or do not like the looks of them, or feel they
      scare your readers, and (b) maybe your cross-references are always
      local-ish, like strictly within an <c>example</c> or a <c>proof</c>. For this
      situation you can create, and employ, a
      <q>local</q>
       tag on a displayed equation. Nothing enforces the idea of what constitutes
      local, and there is nothing to stop you from using the same symbols more than
      once. With freedom comes responsibility.
    </p>

    <p>
      Use the <c>@tag</c> attribute on an <c>mrow</c>, only. (Remember, you can have
      just one <c>mrow</c>.) The behavior is identical within an <c>md</c> or
      <c>mdn</c>. The value of the <c>@tag</c> attribute is a symbol name. The prefix
      <c>d</c> means
      <q>double</q>
       , and the prefix <c>t</c> means
      <q>triple</q>
       . So allowed values are<cd>
         <cline>star, dstar, tstar</cline> <cline>dagger, ddagger, tdagger</cline>
        <cline>daggerdbl, ddaggerdbl, tdaggerdbl</cline> <cline>hash, dhash, thash</cline>
        <cline>maltese, dmaltese, tmaltese</cline>
      </cd>Cross-references to these tagged equations happens in the usual way and
      should behave as expected. We test the double versions to make sure the symbols
      render properly in various output formats.<mdn>
         <mrow xml:id="equation-local-star" tag="dstar">
           c^2 \amp = a^2+b^2
        </mrow> <mrow xml:id="equation-local-dagger" tag="ddagger">
           c^2 \amp = a^2+b^2
        </mrow> <mrow xml:id="equation-local-daggerdbl" tag="ddaggerdbl">
           c^2 \amp = a^2+b^2
        </mrow> <mrow xml:id="equation-local-hash" tag="dhash">
           c^2 \amp = a^2+b^2
        </mrow> <mrow xml:id="equation-local-maltese" tag="dmaltese">
           c^2 \amp = a^2+b^2
        </mrow> <mrow>z^2 \amp = x^2+y^2</mrow>
      </mdn>Here are the local cross-references: <xref
        ref="equation-local-star"
      />, <xref ref="equation-local-dagger" />, <xref
        ref="equation-local-daggerdbl"
      />, <xref ref="equation-local-hash" />, <xref
        ref="equation-local-maltese"
      />. We test another farther away in
      <xref ref="section-cross-referencing" text="type-global" />, contrary to our
      advice above.
    </p>
  </subsection>

  <subsection xml:id="commutative-diagrams">
    <title>Commutative Diagrams</title>

    <p>
      This diagram is authored by Tom Judson using the syntax of the
      <init>AMS</init> <latex />
      <q>CD</q>
       package. Inside of a <tag>me</tag> element start with <c>
         \begin{CD}
      </c>. Remember to escape the less-than character.
      <me>
         \begin{CD} E[x]/\langle p(x) \rangle @>\psi>> F[x]/\langle q(x) \rangle\\
        @VV{\sigma}V @VV{\tau}V\\ E(\alpha) @>\overline{\phi}>> F(\beta)\\ @VVV @VVV\\
        E @>\phi>> F \end{CD}
      </me>
      While this package is not as flexible as some generic drawing packages, it
      has the advantage of full support by MathJax, and thus the
      <init>HTML</init> version will be more accessible.
    </p>
  </subsection>

  <subsection xml:id="line-breaking-math">
    <title>Line-Breaking after Mathematics</title>

    <p>
      As of 2021-05-14, in <init>HTML</init> output the next sentence should
      just fill a full line across the page. We take active measures to bind the
      concluding period to the final bit of mathematics, the variable <m>x</m>. The
      prevents a bad line break which could see the period <em>begin</em> a new line,
      all by itself. In the event that the line-breaking siutation improves, we could
      relax these measures. This testing is only relevant to <init>HTML</init> output,
      not <latex /> output.
    </p>

    <p>
      xxx xxx xxx xxx xxx xxx xxx xxx xxx xxx xxx xxx xxx xxx xxx xxx xxx xxx
      xxx xxx <m>x</m>.
    </p>
  </subsection>

  <subsection xml:id="font-math">
    <title>Fonts and Mathematics</title>

    <p>
      This section is about testing types and sizes of fonts, not so much about
      using different typefaces. First, one long displayed equation, which is
      designed to be full-width for <latex /> output when using defaults as of
      2020-01-29 (commit <c>defd4bffd462e7ea</c>).
    </p>

    <p>
      Start paragraph.<me>
         a^2 + b^2 + a^2 + b^2 + a^2 + b^2 + a^2 + b^2 + a^2 + b^2 + a^2 + b^2 +
        a^2 + b^2 + a^2 + b^2 + a^2 + b^2 + a^2 + b^2
      </me>End paragraph.
    </p>

    <p>
      The next paragraph has five ways to write the sine of <m>x</m>, bracketed by
      plain text versions. This tests font size and the fonts employed. The raw source
      of this paragraph is (spread over two lines)<cd>
         <cline>sin x | &lt;m>\sin x&lt;/m> | &lt;m>\text{sin}\ x&lt;/m> | &lt;m>\mathrm{sin}\ x&lt;/m> |</cline>
        <cline>&lt;m>\text{sin}x&lt;/m> | &lt;m>sin x&lt;/m> | sin x</cline>


      </cd>
      The five ways, from good to bad,
      <ol>
        <li>
          The best way, using <c>\sin</c>. Note the distance to the <m> x </m>.
        </li>
        <li>With a <c>\text{}</c> macro.</li>
        <li>With a <c>\mathrm{}</c> macro. Not recommended for <pretext />.</li>
        <li>
          Without a space. Note that the previous two require explicit spacing.
        </li>
        <li>
          No extra effort, so <latex /> renders as a product of four variables.
        </li>
      </ol>
    </p>

    <p>
      sin x | <m>\sin x</m> | <m>\text{sin}\ x</m> | <m>\mathrm{sin}\ x</m> |
      <m>\text{sin}x</m> | <m>sin x</m> | sin x
    </p>

    <p>
      Finally a simple paragraph that places a text
      <q>x</q>
       next to a variable
      <q>x</q>
       .
    </p>

    <p>wordxx<m>x+x</m>xxword</p>
  </subsection>

  <subsection xml:id="miscellaneous-math">
    <title>Miscellaneous</title>

    <p>
      In <init>HTML</init> output, a MathJax workaround for a Safari rendering
      bug was inserting extra spaces after textual subscripts and superscripts (<url
        href="https://groups.google.com/g/mathjax-users/c/ANjLK9KtcWA/m/vlHaPja-AwAJ"
        visual="groups.google.com/g/mathjax-users/c/ANjLK9KtcWA/m/vlHaPja-AwAJ"
      >MathJax thread</url>). <pretext /> CSS now applies a correction. The
      following tests if the CSS fix is sufficient, and could be used to test
      the necessity of our fix in the future. Following is the original report,
      though <c>NOT</c> has been moved to a superscript:
      <md>
         <mrow>
           T_\text{clk}-t_\text{su} \gt t_\text{clk-Q} + \max\left( t_\text{XOR},
          t^\text{NOT} \right)
        </mrow>
      </md>. There should not be anything to see in <latex />/<init> PDF </init>
      output. (2021-10-21)
    </p>
  </subsection>
</section>

<section xml:id="text-in-paragraphs">
  <title>Entering Text in Paragraphs, Titles, Captions</title>
  <shorttitle> Text in Paragraphs </shorttitle>
  <plaintitle>Entering Text in Paragraphs</plaintitle>

  <introduction>
    <p>
      <init>XML</init>, and therefore <pretext />, is a markup language. But by
      and large, what you type into your source will be what you see in your
      output. So there is not much to say. Except that
      <xref ref="subsection-xml-escape" text="type-global" /> eventually will be
      essential. However we do test various tricky situations here (which have
      technical explanations we avoid). See the Author's Guide for a superior
      treatment of the topics addressed here.
    </p>
  </introduction>

  <subsection xml:id="subsection-xml-escape">
    <title>Special <init>XML</init> characters</title>

    <p>
      One of the goals of <pretext /> is to relieve an author of managing the
      numerous conflicts when mixing languages that use different characters for
      special purposes. But, of course, <init>XML</init> has its own special
      characters.
    </p>

    <p>
      If you type a
      <q>less-than</q>
       symbol in your source, the <init>XML</init> processor thinks you are
      starting an opening, or closing, tag. So how do you get a less-than sign
      into your source so that it survives into your output, like this: &lt;<nbsp />?
      You use an <term>escaped version</term>. Type literally, the four characters
      <c>&amp;lt;</c> in your source. Then the <init> XML </init> processor will
      know you want the character and will not mistake it for a tag. But now we want
      to get an ampersand into our source like: &. How? Another escaped version of
      a character, literally the five characters <c>&amp;amp;</c>.
    </p>

    <p>
      Otherwise, keys on your keyboard, even international versions, should be
      fine in your source and behave as expected. <init>WYTIWYG</init> = What
      You Type Is What You Get. So the principal concession to using
      <init>XML</init> markup is the following very simple rule.
    </p>

    <blockquote>
      <p>
        Rather than pressing the < and & keys on your keyboard, instead always
        enter the escape sequences <c>&amp;lt;</c> and <c>&amp;amp;</c> as
        replacements.
      </p>
    </blockquote>

    <p>
      Simple. And it will work in
      <q>running text,</q>
       verbatim text (like when authoring the content of <tag>c</tag> or
      <tag>pre</tag> elements), and mixed into <latex /> syntax to desribe
      mathematical expressions. <init>XML</init> has three other escape
      sequences <c>&amp;gt;</c>, <c>&amp;apos;</c>, and <c>&amp;quot;</c>, for the
      characters >, ', and " (respectively). But they seem largely unnecessary for
      authoring in PreTeXt, as we now demonstrate by typing them directly from our
      keyboard into our source: >, ', and ".
    </p>

    <exercise>
      <p>
        How was <c>&amp;amp;</c> authored? Work it out, and then check the
        source here for the answer.
      </p>
    </exercise>
  </subsection>

  <subsection>
    <title>Quotations</title>

    <p>
      The <tag>q</tag><idx><h>quotations</h></idx> tag will provide beginning and
      ending double quotations, while the <tag>sq</tag> tag will behave similarly
      but provide single quotes. Given the complexity of quotations, the different
      symbols used in different languages, and the over-simplified versions provided
      on keyboards, it is necessary to use markup.
    </p>

    <p>
      <q>The roots of education are bitter, but the fruit is sweet.</q>
       (Aristotle)
    </p>

    <p>
      <sq>
         It is always wise to look ahead, but difficult to look further than you
        can see.
      </sq>
      (Winston Churchill)
    </p>

    <p>
      A large quote can be accomodated with the <tag>blockquote</tag> tag, which
      can carry within itself an <tag>attribution</tag> element.
    </p>

    <blockquote>
      <p>
        The problem with writing a book in verse is, to be successful, it has to
        sound like you knocked it off on a rainy Friday afternoon. It has to
        sound easy. When you can do it, it helps tremendously because it's a
        thing that forces kids to read on. You have this unconsummated feeling
        if you stop.
      </p>
      <attribution>Dr. Seuss</attribution>
    </blockquote>

    <p>
      We say that again, to test a multiline attribution of a block quotation.
      Notice how the dash appears automatically, and that it is a
      <term>quotation dash</term> in HTML, distinct from other sorts of dashes.
    </p>

    <blockquote>
      <p>
        The problem with writing a book in verse is, to be successful, it has to
        sound like you knocked it off on a rainy Friday afternoon. It has to
        sound easy. When you can do it, it helps tremendously because it's a
        thing that forces kids to read on. You have this unconsummated feeling
        if you stop.
      </p>
      <attribution>
        <line>Dr. Seuss</line><line>Children's Author</line>
      </attribution>


    </blockquote>

    <p>
      Sometimes a quote may extend across several paragraphs. Or a balanced pair
      of quotations marks crosses an XML boundary, so we need left, right,
      single and double versions. (For example, see Section<nbsp /><xref
        ref="poetry"
      />
      on poetry.) Here are all four in a haphazard order: <rq />, <lsq />,
      <lq />, <rsq />. These should be a last resort, and <em>not</em> a
      replacement for the <c>q</c> and <c>sq</c> tags. The left/right versions
      are used for the following quote from Abraham Lincoln, which we have
      edited into two paragraphs.
    </p>

    <p>
      <lq />I am not bound to win, but I am bound to be true. I am not bound to succeed,
      but I am bound to live by the light that I have.
    </p>

    <p>
      I must stand with anybody that stands right, and stand with him while he
      is right, and part with him when he goes wrong.<rq />
    </p>

    <p>
      And as a tests, we try some crazy combinations of quotes, which would
      normally give <latex /> some trouble where the quotation marks are
      adjacent.
      <ul>
        <li>
          <p><q>we use <sq>single quotes inside of double quotes</sq></q></p>
        </li>
        <li>
          <p>
            <sq>
              <q>double quotes inside of single quotes</q>
               with more
            </sq>
          </p>
        </li>
        <li>
          <p><q><sq>single quotes tight inside of double quotes</sq></q></p>
        </li>
        <li>
          <p><sq><q>double quotes tight inside of single quotes</q></sq></p>
        </li>
        <li>
          <p>
            An
            <q><sq><sq><q>absurd test</q></sq></sq></q>
             of two adjacent single quotes inside a pair of double quotes
          </p>
        </li>
        <li>
          <p>
            you would never do this, but a
            <sq><sq>pair of single quotes</sq></sq>
          </p>
        </li>
      </ul>
    </p>

    <p>
      <abbr>N.B.</abbr> We have taken no special care to protect against
      interactions of the actual quote characters (described above) in <latex />
      with themselves, or with the grouping tags.
    </p>
  </subsection>

  <subsection>
    <title>Groupings</title>

    <p>
      It is possible to make some other groupings like quotations, such as {some
      <em>emphasized text</em> grouped within braces}, or [a
      <pubtitle>Book Title</pubtitle>
       inside brackets], an <articletitle>Article Title</articletitle>, <angles>
         some <foreign>foreign words</foreign> inside angle brackets
      </angles>, or
      <dblbrackets>just a bit of text within double brackets</dblbrackets>. Some
      of these are used extensively by scholars who study texts to note various restorations
      or deletions. Note that the <tag>foreign</tag> element may have a <c>
         xml:lang
      </c> attribute.
    </p>

    <p>
      Note that the angle brackets, <langle /> and <rangle />, are <em>not</em> the
      keyboard characters, < and >. Your best bet is to use the provided <tag>
         angles
      </tag> element when constructing a balanced pair. Similarly, <tag>
         dblbrackets
      </tag> is provided to make the double-bracket characters easily available,
      since they are likely not on your keyboard.
    </p>
  </subsection>

  <subsection>
    <title>Characters, Symbols, and Constructions</title>

    <p>
      Some keyboard characters are ambiguous. Is the character <c>'</c> an
      apostrophe or a right single quote? We presume the former, ', and provide
      markup as an alternative for the latter (described above). Is <c>/</c>
      used to separate words, or to form a fraction? We presume the former, /,
      and provide <tage>solidus</tage>, <solidus />, for the latter. We test
      some other characters straight from our US keyboard (with two being escape
      sequences).
    </p>

    <p>~ ` ! @ # $ % ^ & * ( ) _ - + = [ ] { } | \ ; : ' " , < . > ? /</p>

    <p>And again as verbatim text.</p>

    <p>
      <c>~ ` ! @ # $ % ^ & * ( ) _ - + = [ ] { } | \ ; : ' " , < . > ? /</c>
    </p>

    <p>
      Note that for a long time <pretext /> had empty elements for many of these
      characters, as a consequence of naïveté. So you might see
      <tage>dollar</tage>, <tage>ampersand</tage>, or others in old source. They
      will be deprecated and will raise warnings.
    </p>

    <p>
      Now, when a character is nowhere to be found on your keyboard, we provide
      conveniences as markup. Or a keyboard character may have a different
      variant which we implement as an empty element. Here we test many of
      these. Read the Author's Guide for tags and more detail.
    </p>

    <p>
      <copyright /><nbsp /><nbsp /> <phonomark /><nbsp /><nbsp /> <copyleft /><nbsp /><nbsp />
      <registered /><nbsp /><nbsp /> <trademark /><nbsp /><nbsp />
      <servicemark /><nbsp /><nbsp /> <ellipsis /><nbsp /><nbsp /> <midpoint /><nbsp /><nbsp />
      <swungdash /><nbsp /><nbsp /> <permille /><nbsp /><nbsp /> <pilcrow /><nbsp /><nbsp />
      <section-mark /><nbsp /><nbsp /> <minus /><nbsp /><nbsp /> <times /><nbsp /><nbsp />
      <solidus /><nbsp /><nbsp /> <obelus /><nbsp /><nbsp /> <plusminus />
    </p>

    <p>
      There are a few common abbreviations of Latin phrases that can be achieved
      in HTML one way, and in <latex /> with a slightly different mechanism.
      These are due to <latex />'s treatment of a period (full stop), depending on
      its surroundings. So not reserved characters, but just divergent treatment.
      Using these will lead to the best quality in all your outputs. See Will Robertson's
      informative and arcane <url
        href="http://latex-alive.tumblr.com/post/827168808/correct-punctuation-spaces"
        visual="latex-alive.tumblr.com/post/827168808"
      >blog post</url> on the topic if you want the full story for the treatment
      of a full stop in <latex />.
    </p>

    <tabular>
       <row><cell>Tag</cell><cell>Realization</cell><cell>Meaning</cell></row> <row>
        <cell><c>ad</c></cell><cell><ad /></cell><cell>
          <foreign>anno Domini</foreign>, in the year of the Lord
        </cell>
      </row> <row>
        <cell><c>am</c></cell><cell><am /></cell><cell>
          <foreign>ante meridiem</foreign>, before midday
        </cell>
      </row> <row>
        <cell><c>bc</c></cell><cell><bc /></cell><cell>
          English, before Christ
        </cell>
      </row> <row>
        <cell><c>ca</c></cell><cell><ca /></cell><cell>
          <foreign>circa</foreign>, about
        </cell>
      </row> <row>
        <cell><c>eg</c></cell><cell><eg /></cell><cell>
          <foreign>exempli gratia</foreign>, for example
        </cell>
      </row> <row>
        <cell><c>etal</c></cell><cell><etal /></cell><cell>
          <foreign>et alia</foreign>, and others
        </cell>
      </row> <row>
        <cell><c>etc</c></cell><cell><etc /></cell><cell>
          <foreign>et caetera</foreign>, and the rest
        </cell>
      </row> <row>
        <cell><c>ie</c></cell><cell><ie /></cell><cell>
          <foreign>id est</foreign>, in other words
        </cell>
      </row> <row>
        <cell><c>nb</c></cell><cell><nb /></cell><cell>
          <foreign>nota bene</foreign>, note well
        </cell>
      </row> <row>
        <cell><c>pm</c></cell><cell><pm /></cell><cell>
          <foreign>post meridiem</foreign>, after midday
        </cell>
      </row> <row>
        <cell><c>ps</c></cell><cell><ps /></cell><cell>
          <foreign>post scriptum</foreign>, after what has been written
        </cell>
      </row> <row>
        <cell><c>vs</c></cell><cell><vs /></cell><cell>
          <foreign>versus</foreign>, against
        </cell>
      </row> <row>
        <cell><c>viz</c></cell><cell><viz /></cell><cell>
          <foreign>videlicet</foreign>, namely
        </cell>
      </row>
    </tabular>

    <p>
      We also distinguish between abbreviations (<abbr>vs.</abbr>), acronyms (<acro>
         SCUBA
      </acro>) and initialisms (<init>XML</init>). This is a test of the text
      version of a multiplication symbol: 2<nbsp /><times /><nbsp />4.
    </p>
    <p>
      Simple coordinates with degrees, minutes, seconds, or temperature, or
      distance in feet and inches.
      <q>
        We parked the car at 36<degree />16<prime />0.83<dblprime />N, 122<degree />35<prime />47.27<dblprime />W,
        and since it was 93<degree />F, we walked 505<prime />3.6<dblprime /> so
        we could swim in the bay.
      </q>
    </p>

    <p>
      An <term>em dash</term> is the long dash used much like parentheses (not
      an <term>en dash</term> used to denote a range, such as a range of page
      numbers). It should not have spaces around it, but some style guides allow
      for a <em>thin</em> space, which<mdash />we test right now. The command
      line stringparam <c>emdash.space</c> can be set to <c>none</c> or
      <c>thin</c> to control this.
    </p>
  </subsection>

  <subsection>
    <title>Currency</title>

    <p>
      For best results, be certain the right Unicode characters are in your
      source. If you only need a certain symbol rarely, you can enter it in your
      source via its Unicode number. For example, to obtain a peso, type
      <c>&amp;#x20B1;</c>. This table has been tested with our default fonts, and
      should be fine for <init>HTML</init> output. Please report any difficulties
      with different <latex /> fonts, as there are extra measures we can take to
      make these more robust. (We've already done this for the Paraguayan guaraní.)
    </p>
    <table>
      <title>Supported Currency</title>
      <tabular>
         <row bottom="medium">
          <cell>Sign</cell><cell>Unicode</cell><cell>Name</cell>
        </row> <row>
          <cell>$</cell><cell><c>U+0024</c></cell><cell>dollar</cell>
        </row> <row>
          <cell>¢</cell><cell><c>U+00A2</c></cell><cell>cent</cell>
        </row> <row>
          <cell>£</cell><cell><c>U+00A3</c></cell><cell>sterling</cell>
        </row> <row>
          <cell>¤</cell><cell><c>U+00A4</c></cell><cell>currency</cell>
        </row> <row>
          <cell>¥</cell><cell><c>U+00A5</c></cell><cell>yen</cell>
        </row> <row>
          <cell>ƒ</cell><cell><c>U+0192</c></cell><cell>florin</cell>
        </row> <row>
          <cell>฿</cell><cell><c>U+0E3F</c></cell><cell>baht</cell>
        </row> <row>
          <cell>₡</cell><cell><c>U+20A1</c></cell><cell>colon</cell>
        </row> <row>
          <cell>₤</cell><cell><c>U+20A4</c></cell><cell>lira</cell>
        </row> <row>
          <cell>₦</cell><cell><c>U+20A6</c></cell><cell>naira</cell>
        </row> <row>
          <cell>₩</cell><cell><c>U+20A9</c></cell><cell>won</cell>
        </row> <row>
          <cell>₫</cell><cell><c>U+20AB</c></cell><cell>dong</cell>
        </row> <row>
          <cell>€</cell><cell><c>U+20AC</c></cell><cell>euro</cell>
        </row> <row>
          <cell>₱</cell><cell><c>U+20B1</c></cell><cell>peso</cell>
        </row> <row>
          <cell>₲</cell><cell><c>U+20B2</c></cell><cell>guarani</cell>
        </row>
      </tabular>


    </table>
  </subsection>

  <subsection xml:id="subsection-icons-in-text">
    <title>Icons in Text</title>

    <p>
      A limited supply of icons can be used when explaining how to use some
      computer application. The empty element is <tage>icon</tage> and the
      attribute is <attr>name</attr>.
    </p>

    <p>
      We sprinkle <icon name="gear" /> a few into a few sentences
      <icon name="wrench" /> to check baselines <icon name="file-save" /> and
      font sizing. We sprinkle <icon name="gear" /> a few into a few sentences
      <icon name="wrench" /> to check baselines <icon name="file-save" /> and
      font sizing. We sprinkle <icon name="gear" /> a few into a few sentences
      <icon name="wrench" /> to check baselines <icon name="file-save" /> and
      font sizing. We sprinkle <icon name="gear" /> a few into a few sentences
      <icon name="wrench" /> to check baselines <icon name="file-save" /> and
      font sizing.
    </p>

    <table>
      <title>User-Interface Icons</title>

      <tabular>
         <col /> <col halign="center" right="medium" /> <col /> <col
          halign="center"
          right="medium"
        /> <col /> <col halign="center" /> <row bottom="medium">
          <cell>Name</cell><cell>Icon</cell><cell>Name</cell><cell>
            Icon
          </cell><cell>Name</cell><cell>Icon</cell>
        </row> <row>
          <cell><c>arrow-down</c></cell><cell>
            <icon name="arrow-down" />
          </cell><cell><c>arrow-left</c></cell><cell>
            <icon name="arrow-left" />
          </cell><cell><c>arrow-right</c></cell><cell><icon
              name="arrow-right"
            /></cell>
        </row> <row>
          <cell><c>arrow-up</c></cell><cell>
            <icon name="arrow-up" />
          </cell><cell><c>file-save</c></cell><cell>
            <icon name="file-save" />
          </cell><cell><c>gear</c></cell><cell><icon name="gear" /></cell>
        </row> <row>
          <cell><c>menu</c></cell><cell><icon name="menu" /></cell><cell>
            <c>wrench</c>
          </cell><cell><icon name="wrench" /></cell><cell /><cell />


        </row>


      </tabular>
    </table>

    <p>
      Nominations of new icons must
      <ul>
        <li>Have a Unicode character representation.</li>
        <li>Be in the <init>HTML/CSS/JS</init> Font Awesome catalog.</li>
        <li>Be in the <latex /> <c>fontawesome</c> package.</li>
        <li>Have a reasonably semantic <pretext /> name.</li>
      </ul>
       Please supply all this information, including the official Unicode name,
      with your request. Better yet, form a pull request.
    </p>

    <warning>
      <title>Icons, <c>xelatex</c>, and Fonts</title>

      <p>
        When processing a <latex /> file with <c>xelatex</c> the FontAwesome
        icons are expected to be in a <em>system</em> font whose name is
        <c>FontAwesome</c>. This is not a filename, and installing the <latex />
        <c>fontawesome</c> package into your <latex /> installation does not mean
        you have made this font available as a <em>system</em> font.
      </p>

      <p>
        The Publisher's Guide contains some discussion about installing fonts
        into a system, as part of the documentation of creating a <latex />
        style, and has particular warnings about only using the <latex />
        <c>fontawesome</c> package as a vehicle for installing and accessing
        these fonts.
      </p>
    </warning>
  </subsection>

  <subsection xml:id="subsection-keyboard">
    <title>Keyboard Keys</title>
    <idx>keyboard keys</idx>

    <p>
      Your text can include specialized text meant to look like a key on the
      keyboard of a calculator or other device. So you can go <kbd>b</kbd>
      <kbd>Enter</kbd> <kbd>&lt;</kbd> or <kbd>F1</kbd>. Or maybe a sequence as:
      <kbd>Tab</kbd> > <kbd>Ctrl</kbd> > <kbd>T</kbd>. Use the <tag>kbd</tag>
      element, with the label of the key as content.
    </p>

    <p>
      There is a growing supply of keys which are labeled with graphics rather
      than text, such as a left arrow <kbd name="left" />, right arrow <kbd
        name="right"
      />, up arrow <kbd name="up" />, down arrow <kbd name="down" />, and Enter
      <kbd name="enter" />. See
      <pubtitle>The <pretext /> Guide</pubtitle>
       for the definitive list. In <xref ref="named-keyboard-keys" /> the literal
      column means the symbol/character is the content of a <tag>kbd</tag> element,
      while the named column means the symbol/character has been chosen via the value
      of the <attr>name</attr> attribute of an empty <tage>kbd</tage> element.
    </p>

    <table xml:id="named-keyboard-keys">
      <title>Named keys</title>
      <tabular halign="center">
         <row><cell /><cell>Literal</cell><cell>Named</cell></row> <row>
          <cell>Ampersand</cell><cell><kbd>&</kbd></cell><cell>
            <kbd name="ampersand" />
          </cell>
        </row> <row>
          <cell>Less than</cell><cell><kbd>&lt;</kbd></cell><cell>
            <kbd name="less" />
          </cell>
        </row> <row>
          <cell>Greater than</cell><cell><kbd>></kbd></cell><cell>
            <kbd name="greater" />
          </cell>
        </row> <row>
          <cell>Dollar</cell><cell><kbd>$</kbd></cell><cell>
            <kbd name="dollar" />
          </cell>
        </row> <row>
          <cell>Per cent</cell><cell><kbd>%</kbd></cell><cell>
            <kbd name="percent" />
          </cell>
        </row> <row>
          <cell>Open brace</cell><cell><kbd>{</kbd></cell><cell>
            <kbd name="openbrace" />
          </cell>
        </row> <row>
          <cell>Close brace</cell><cell><kbd>}</kbd></cell><cell>
            <kbd name="closebrace" />
          </cell>
        </row> <row>
          <cell>Hash</cell><cell><kbd>#</kbd></cell><cell>
            <kbd name="hash" />
          </cell>
        </row> <row>
          <cell>Backslash</cell><cell><kbd>\</kbd></cell><cell>
            <kbd name="backslash" />
          </cell>
        </row> <row>
          <cell>Tilde</cell><cell><kbd>~</kbd></cell><cell>
            <kbd name="tilde" />
          </cell>
        </row> <row>
          <cell>Circumflex</cell><cell><kbd>^</kbd></cell><cell>
            <kbd name="circumflex" />
          </cell>
        </row> <row>
          <cell>Underscore</cell><cell><kbd>_</kbd></cell><cell>
            <kbd name="underscore" />
          </cell>
        </row>
      </tabular>


    </table>

    <table>
      <title>Upper Case</title>
      <tabular halign="center">
         <row>
          <cell><kbd>~</kbd></cell><cell><kbd>!</kbd></cell><cell>
            <kbd>@</kbd>
          </cell><cell><kbd>#</kbd></cell><cell><kbd>$</kbd></cell><cell>
            <kbd>%</kbd>
          </cell><cell><kbd>^</kbd></cell><cell><kbd>&</kbd></cell><cell>
            <kbd>*</kbd>
          </cell><cell><kbd>(</kbd></cell><cell><kbd>)</kbd></cell><cell>
            <kbd>_</kbd>
          </cell><cell><kbd>+</kbd></cell><cell />
        </row> <row>
          <cell><kbd>Tab</kbd></cell><cell><kbd>Q</kbd></cell><cell>
            <kbd>W</kbd>
          </cell><cell><kbd>E</kbd></cell><cell><kbd>R</kbd></cell><cell>
            <kbd>T</kbd>
          </cell><cell><kbd>Y</kbd></cell><cell><kbd>U</kbd></cell><cell>
            <kbd>I</kbd>
          </cell><cell><kbd>O</kbd></cell><cell><kbd>P</kbd></cell><cell>
            <kbd>{</kbd>
          </cell><cell><kbd>}</kbd></cell><cell><kbd>|</kbd></cell>
        </row> <row>
          <cell><kbd>CapsLock</kbd></cell><cell><kbd>A</kbd></cell><cell>
            <kbd>S</kbd>
          </cell><cell><kbd>D</kbd></cell><cell><kbd>F</kbd></cell><cell>
            <kbd>G</kbd>
          </cell><cell><kbd>H</kbd></cell><cell><kbd>J</kbd></cell><cell>
            <kbd>K</kbd>
          </cell><cell><kbd>L</kbd></cell><cell><kbd>:</kbd></cell><cell>
            <kbd>'</kbd>
          </cell><cell><kbd>Enter</kbd></cell><cell />
        </row> <row>
          <cell><kbd>Shift</kbd></cell><cell><kbd>Z</kbd></cell><cell>
            <kbd>X</kbd>
          </cell><cell><kbd>C</kbd></cell><cell><kbd>V</kbd></cell><cell>
            <kbd>B</kbd>
          </cell><cell><kbd>N</kbd></cell><cell><kbd>M</kbd></cell><cell>
            <kbd>&lt;</kbd>
          </cell><cell><kbd>></kbd></cell><cell><kbd>?</kbd></cell><cell>
            <kbd>Shift</kbd>
          </cell><cell />
        </row>
      </tabular>


    </table>

    <table>
      <title>Lower Case</title>
      <tabular halign="center">
         <row>
          <cell><kbd>`</kbd></cell><cell><kbd>1</kbd></cell><cell>
            <kbd>2</kbd>
          </cell><cell><kbd>3</kbd></cell><cell><kbd>4</kbd></cell><cell>
            <kbd>5</kbd>
          </cell><cell><kbd>6</kbd></cell><cell><kbd>7</kbd></cell><cell>
            <kbd>8</kbd>
          </cell><cell><kbd>9</kbd></cell><cell><kbd>0</kbd></cell><cell>
            <kbd>-</kbd>
          </cell><cell><kbd>=</kbd></cell><cell />
        </row> <row>
          <cell><kbd>Tab</kbd></cell><cell><kbd>q</kbd></cell><cell>
            <kbd>w</kbd>
          </cell><cell><kbd>e</kbd></cell><cell><kbd>r</kbd></cell><cell>
            <kbd>t</kbd>
          </cell><cell><kbd>y</kbd></cell><cell><kbd>u</kbd></cell><cell>
            <kbd>i</kbd>
          </cell><cell><kbd>o</kbd></cell><cell><kbd>p</kbd></cell><cell>
            <kbd>[</kbd>
          </cell><cell><kbd>]</kbd></cell><cell><kbd>\</kbd></cell>
        </row> <row>
          <cell><kbd>CapsLock</kbd></cell><cell><kbd>a</kbd></cell><cell>
            <kbd>s</kbd>
          </cell><cell><kbd>d</kbd></cell><cell><kbd>f</kbd></cell><cell>
            <kbd>g</kbd>
          </cell><cell><kbd>h</kbd></cell><cell><kbd>j</kbd></cell><cell>
            <kbd>k</kbd>
          </cell><cell><kbd>l</kbd></cell><cell><kbd>;</kbd></cell><cell>
            <kbd>'</kbd>
          </cell><cell><kbd>Enter</kbd></cell><cell />
        </row> <row>
          <cell><kbd>Shift</kbd></cell><cell><kbd>z</kbd></cell><cell>
            <kbd>x</kbd>
          </cell><cell><kbd>c</kbd></cell><cell><kbd>v</kbd></cell><cell>
            <kbd>b</kbd>
          </cell><cell><kbd>n</kbd></cell><cell><kbd>m</kbd></cell><cell>
            <kbd>,</kbd>
          </cell><cell><kbd>.</kbd></cell><cell><kbd>/</kbd></cell><cell>
            <kbd>Shift</kbd>
          </cell><cell />
        </row>
      </tabular>


    </table>
  </subsection>

  <subsection xml:id="section-urls">
    <title>URLs, such as <url href="http://example.com" /></title>
    <idx><h>link</h><h>external, url</h></idx><idx>
      <h>reference</h><h>external, url</h>
    </idx>

    <p>
      The <tag>url</tag> element can be used to create an external reference.
      The mandatory <attr>href</attr> attribute is the actual <init>URL</init>
      complete with the protocol (e.g. <c>https://</c>). Content for the element
      is optional, and if provided will be the
      <q>clickable</q>
       text. In this case, a <attr>visual</attr> attribute must be provided, and
      this will become a footnote with a more friendly version of the <init>
         URL
      </init>. When no content is provided, the
      <q>clickable</q>
       will be the <init>URL</init> with a preference for an optional
      <attr>visual</attr>. This subsection has some (extreme) tests and we leave
      complete documentation and full details for the <pretext /> Guide.
    </p>

    <p>
      A long <init>URL</init> for testing:
      <url
        href="http://www.pcc.edu/enroll/registration/dropping.html#withdraw"
        visual="www.pcc.edu/enroll/registration/dropping.html#withdraw"
      />. Notice in the source that you <em>do not</em> put any tags inside the <attr>
         href
      </attr> or <attr>visual</attr> attributes, but you may need to provide XML
      escape sequences (see <xref
        ref="subsection-xml-escape"
        text="type-global"
      />).
    </p>

    <p>
      A <tag>url</tag> element with content will get a footnote, containing the
      (simplified) URL in the mandatory <attr>visual</attr> attribute. If you do
      not provide the <attr>visual</attr> attribute in this case, then you are
      using a construction that was deprecated on 2020-01-05. If you insist, you
      can make the <attr>visual</attr> attribute identical to the
      <attr>href</attr> attribute. Some tests:
      <ul>
        <li>
          <url href="http://example.com/" visual="example.com">
             With a useful <attr>visual</attr> attribute
          </url>
        </li>
        <li>
          <url href="http://example.com/" visual="http://example.com/">
             With a duplicate <attr>visual</attr> attribute
          </url>
        </li>
        <li>
          <url href="http://example.com/">
             Without a <attr>visual</attr> attribute (deprecated)
          </url>
        </li>
      </ul>
    </p>

    <p>
      Here is a totally bogus <init>URL</init>, which contains every possible legal
      character, so if this fails to convert there is some problematic character.
      In order to test the use of a percent sign (<c>%</c>) in a URL, we follow it
      by two hex digits, specifically, <c>58</c>, which is a way to represent
      the character <c>X</c> in a <init>URL</init>. Normal text, monospace text,
      <tag>url</tag> with just <attr>href</attr>, <tag>url</tag> with
      <attr>href</attr> and <attr>visual</attr>, <tag> url </tag> with <attr>
         href
      </attr>, <attr>visual</attr> and content. Notice how the various versions
      do, or do not, line-break in <latex />/PDF output, including the (potentially
      confusing) use of a use of a hyphen in the normal text version
    </p>

    <blockquote>


      <p>
        ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%-._~:/?#[]@!$&amp;'()*+,;=
      </p>

      <p>
        <c>
           ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%-._~:/?#[]@!$&amp;'()*+,;=


        </c>
      </p>

      <p>
        <url
          href="http://example.com/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%58-._~:/?#[]@!$&amp;'()*+,;="
        />
      </p>

      <p>
        <url
          href="http://example.com/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%58-._~:/?#[]@!$&amp;'()*+,;="
          visual="example.com/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%58-._~:/?#[]@!$&amp;'()*+,;="
        />
      </p>

      <p>
        <url
          href="http://example.com/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%58-._~:/?#[]@!$&amp;'()*+,;="
          visual="example.com/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%58-._~:/?#[]@!$&amp;'()*+,;="
        >Characters to a footnote</url>
      </p>


    </blockquote>

    <p>
      Line-breaking in <latex />/PDF output is specialized, using path separators
      (slashes) as candidates for splitting across lines: <url href="http://example.com/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer/longer" />
    </p>

    <p>
      We are not fans of footnotes, they are totally unstructured.<fn>
         <url
          href="https://en.wikipedia.org/wiki/Carleson%27s_theorem"
          visual=""
        >Carleson's Theorem</url>
      </fn> A URL in a footnote migrates around, and so care must be taken.<fn>
         <url
          href="http://example.com/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%58-._~:/?#[]@!$&amp;'()*+,;="
        />
      </fn>
      This paragraph has two footnotes, one with a real URL from Jesse Oldroyd,
      another with a fake URL from the above suite. For good measure, we repeat
      the URL found in the first footnote (which lacks its own footnote by
      design):
      <url href="https://en.wikipedia.org/wiki/Carleson%27s_theorem" visual="">
         Carleson's Theorem
      </url>. And we include a no-content version of the same link, with a visual
      version provided and employed: <url
        href="https://en.wikipedia.org/wiki/Carleson%27s_theorem"
        visual="en.wikipedia.org/wiki/Carleson%27s_theorem"
      />.
    </p>
  </subsection>

  <subsection>
    <title>Biological Names</title>
    <idx>biological names</idx><idx>
      <h>biological names</h><h>taxon</h>
    </idx><idx><h>scientific names</h><see>biological names</see></idx>

    <p>
      The <c>taxon</c><idx>taxon</idx><idx>
        <h>biological names</h><h>taxon</h>
      </idx>
      element can be used all by itself to get an italicized scientific name, as
      in <taxon>Escherichia coli</taxon>. It can also be structured with the elements
      <c>genus</c><idx>genus</idx><idx><h>biological names</h><h>genus</h></idx>
      and <c>species</c>,<idx>species</idx><idx>
        <h>biological names</h><h>species</h>
      </idx>
      as in using both together in
      <taxon><genus>Cyclops</genus><species>kolensis</species></taxon>. Or the subelements
      can be used individually. Rules for capitalization are presently your responsibility
      as an author. Possible improvements include new subelements, attributes for
      database identifiers, and checks on capitalization. Also, we might automatically
      abbreviate the genus after first use.
    </p>

    <p>
      There is an attribute, <c>@ncbi</c><idx>ncbi attribute</idx><idx>
        <h>attributes</h><h>ncbi attribute</h>
      </idx><idx><h>biological names</h><h>ncbi attribute</h></idx> that you can
      use on the <c>taxon</c> element to precisely identify the organism you are
      discussing using an identification number from the <url
        href="https://www.ncbi.nlm.nih.gov/"
        visual="www.ncbi.nlm.nih.gov"
      >National Center for Biotechnology Information</url>. Their
      <url
        href="https://www.ncbi.nlm.nih.gov/taxonomy"
        visual="www.ncbi.nlm.nih.gov/taxonomy"
      >taxonomy</url>
      is at <c>www.ncbi.nlm.nih.gov/taxonomy</c>. Right now, we do not do anything
      with this attribute, but things like links are certainly possible. See the
      source of this document to see it in use with <taxon ncbi="7229">
         <genus>Drosophila</genus><species>miranda</species>
      </taxon> which could be used to construct a link to <url
        href="https://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?id=7229"
        visual="www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?id=7229"
      >further information via id number</url> or even <url
        href="https://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?name=Drosophila+miranda"
        visual="www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?name=Drosophila+miranda"
      >further information via just the name</url>.
    </p>
  </subsection>

  <subsection>
    <title>Verbatim in titles, <c>\a&b#c%d~e{f}g$h_i^j</c>, OK</title>

    <p>
      You can test the migration of the <latex /> special characters in this
      section title by requesting a 2-deep Table of Contents with
      <c> --stringparam toc.level 2</c>.
    </p>
  </subsection>

  <subsection xml:id="subsection-special-situations">
    <title>Special Situations</title>

    <p>
      Sage defines a nice syntax for generators of algebraic structures, but we
      must remember to use an escape sequence for the < symbol (see
      <xref ref="subsection-xml-escape" text="type-global" />).
    </p>

    <sage>
       <input>
                    P.&lt;t> = ZZ[]
                    P
                    </input>
      <output>Univariate Polynomial Ring in t over Integer Ring</output>
    </sage>

    <p>
      There is an alternate Sage syntax, which avoids the less-than and greater
      symbols.
    </p>

    <sage>
       <input>
                    R = ZZ['u']
                    u = R.gen(0)
                    (u, R)
                    </input>
      <output>(u, Univariate Polynomial Ring in u over Integer Ring)</output>


    </sage>

    <p>
      Ampersands, less-than, and greater symbols are likely to be necessary in
      source code, such as Sage code (think generators of field extensions) or
      TikZ code (think arrowheads), and in matrices (think separating entries).
      If you have a big matrix, or a huge chunk of TikZ code, you can protect it
      all at once from the XML processor by wrapping it in <c>&lt;![CDATA[</c><nbsp /><nbsp /><nbsp /><c>
         ]]>
      </c>. It should be possible to write without ever using the
      <q>CDATA</q>
       mechanism, but it might get tedious in places to use the supplied macros or
      <init>XML</init> escape sequences. This construction is often mis-understood
      as a solution better remedied by reading <xref
        ref="subsection-xml-escape"
        text="type-global"
      /> again.
    </p>

    <p>
      We test the three pre-defined <latex /> macros for &, &lt;, and > with a
      pair of aligned equations:<md> <mrow>a^2 + b^2\amp\lt c^2</mrow> <mrow>
           c^2\amp\gt a^2 + b^2
        </mrow> </md>
    </p>
  </subsection>

  <subsection xml:id="subsection-jupyter-dollars">
    <title>Jupyter Notebook, Markdown, MathJax, Delimiters</title>

    <p>
      A Jupyter notebook allows a mix of <init>HTML</init> (our logistical
      preference for a conversion) and Markown (another set of special
      characters and their escaped versions). Certain pairs of delimiters, when
      appearing in consecutive <init>HTML</init> <tag>code</tag> elements
      require extraordinary care. But the one nut we cannot crack is pairs of
      dollar signs. So the next paragraph is known to render badly in a Jupyter
      notebook, but should otherwise be a bit boring.
    </p>

    <p><c>$</c> and <c>$</c></p>
  </subsection>

  <subsection>
    <title><latex /> Characters, Ligatures, and More</title>

    <p>
      This section is just for testing, and the more you know about <latex />, the
      more we would encourage you to <em>not</em> to read this. Look to the Author's
      Guide for the <em>right</em> way to author your source.
    </p>

    <p>
      The ten reserved characters, directly in the source: # $ % ^ & _ { } ~ \.
      And again: X#X$X%X^X&X_X{X}X~X\X, but smashed up tight to intermediate
      characters.
    </p>

    <p>In a verbatim presentation: <c># $ % ^ & _ { } ~ \</c>.</p>

    <p>
      And <c>X#X$X%X^X&X_X{X}X~X\X</c>. (These verbatim versions are authored in
      different paragraphs to work around the Jupyter notebook bug described above.)
    </p>

    <p>
      We also disrupt certain constructions from <latex />. Attempting to sneak-in
      any traditional macro for the purposes of <latex />-only output, such as,
      say a \newpage, will fail since the leading backslash will be caught and
      converted to <c>\textbackslash</c>. (See? It just happened twice.) For technical
      reasons we want to particularly test \textbackslash, \textbraceleft, and \textbraceright.
    </p>

    <p>
      Four
      <q><tex /> ligatures</q>
       , <c>--</c>, <c>---</c>, <c>``</c>, and <c>''</c>, authored in running
      text, --, ---, ``, ''. It may be hard to tell that the two consecutive
      apostrophes have not coalesced into a curly left smart quote, but see
      below, the spacing is subtly different.
    </p>

    <p>
      We want the double quote mark from your keyboard, <c>"</c>, to not morph into
      some other character: "<nbsp />.
    </p>

    <p>
      More testing: runs of hyphens. Such as: - (one), -- (two), --- (three),
      ---- (four), ----- (five), ------ (six), ------- (seven). Use the empty
      elements <tage>ndash</tage> and <tage>mdash</tage> for the longer
      dashes/hyphens.
    </p>

    <p>
      Runs of apostrophes should not become smart right double quotes: ' (one),
      '' (two), ''' (three), '''' (four), ''''' (five), '''''' (six), '''''''
      (seven). You might want to cut-and-paste these into a text file to
      convince yourself there are the right number of characters. Here are two
      smart right double quotes, separated by a non-breaking space, for visual
      comparison: <rq /><nbsp /><rq />. Or 30 apostrophes on a line of their own
      (longer) followed by 15 smart right double quotes (shorter).
    </p>
    <p>''''''''''''''''''''''''''''''.</p>
    <p>
      <rq /><rq /><rq /><rq /><rq /><rq /><rq /><rq /><rq /><rq /><rq /><rq /><rq /><rq /><rq />.
    </p>

    <p>
      Runs of backticks (accent grave) should not become smart left double
      quotes when the output is processed by <latex />: ` (one), `` (two), ``` (three),
      ```` (four), ````` (five), `````` (six), ``````` (seven). Furthermore, in a
      context where Markdown syntax is recognized as well (<eg /> a Jupyter
      notebook), paired backticks should <em>not</em> produce `inline verbatim
      text`.
    </p>

    <p>
      The next paragraph has a long run of words separated/joined by the
      keyboard forward-slash character. With this input, <latex /> will not
      line-break at the slash, nor will it hypenate anywhere. <pretext />
      automatically provides an improved slash, which will line-break, as you
      should see below in <latex /> output. There is a bad right margin, but
      that is due to the absurdity of this test. This sort of problem should be
      no better or worse for the use of this character. Further refinements
      (zero-width space) and packages can be used to get hyphenation.
      <init>HTML</init> will line-break rationally with no extra help. Remember
      the <tage>solidus</tage> character for super-simple text fractions like 7<solidus />32
      (which will <em>not</em> line-break), and math elements or SI unit markup
      for technical work.
    </p>

    <p>
      A/test/of/some/short/words/that/go/off/the/end/of/a/line/A/test/of/some/short/words/that/go/off/the/end/of/a/line/A/test/of/some/short/words/that/go/off/the/end/of/a/line/A/test/of/some/short/words/that/go/off/the/end/of/a/line/A/test/of/some/short/words/that/go/off/the/end/of/a/line.
    </p>
  </subsection>

  <subsection>
    <title><init>HTML</init> and accidental mathematics</title>

    <p>
      We render mathematics in web pages with the fantastic MathJax Javascript
      library. Simplifying just a bit, it recognizes <latex /> syntax within a
      page, takes control of that text, and replaces it wth nice fonts and
      formatting. Now, if you write about <latex /> you might well have some
      mathematics in your examples. Best practice would be to use verbatim text
      for that, and we mark off such text as being off-limits to MathJax.
    </p>

    <p>
      But if you are writing running text, then you can (accidentally) author
      some text which MathJax recognizes and converts to something (unintended).
      And if you are doing this intentionally, then you have ignored <pretext />
      markup for mathematics, and are missing out on some features.
    </p>

    <p>A few tests that we can prevent any accidents.</p>

    <p>Inline mathematics: \(x^2\).</p>

    <p>Display mathematics: \begin{align}x^2+y^2=z^2\end{align}</p>

    <p>
      Double backticks is a common <latex /> construction, which in <latex />/PDF
      output <em>should not</em> become an opening quote-mark. Also, a single backtick
      in HTML is a signal for MathJax to interpret ASCIIMath, and then a double backtick
      causes
      <q>random</q>
       pieces of mathematics on a page to not render at all. So we have a quotation
      authored <latex />-style: ``We have nothing to fear, but fear itself.''
    </p>
  </subsection>
</section>

<section xml:id="graphics">

  <title>Graphics</title>

  <introduction>
    <p>
      In addition to including images created externally (e.g. photographs),
      <pretext /> supports several languages for describing diagrams and
      pictures with human-readable source code (<ie /> plain text), rather than using
      a
      <q>paint</q>
       program. This section describes the various methods for incorporationg, or
      generating, graphis, images or diagrams.
    </p>
  </introduction>

  <subsection>
    <title>Images from External Sources</title>

    <p>
      If you have raster images (photographs, etc.) then they are specified with
      complete filenames, as above in Figure<nbsp /><xref
        ref="figure-function-derivative"
      />
      or just below.
    </p>

    <figure>
      <caption>
        New Zealand Landscape,
        <url
          href="https://commons.wikimedia.org/wiki/File:NZ_Landscape_from_the_van.jpg"
          visual="commons.wikimedia.org/wiki/File:NZ_Landscape_from_the_van.jpg"
        ><c>commons.wikimedia.org</c></url>, CC-BY-SA-2.0
      </caption><image source="images/nz-landscape.jpg" width="80%" />
    </figure>

    <p>
      If you have existing images that are vector graphics, then PDF format
      works best for <latex /> output and SVG format works best for HTML. The
      utility <c>pdf2svg</c> works well for converting PDF to SVG. In this case,
      specify your source as a filename, but leave off the file extension, and
      the appropriate version will be used for the current output format.
    </p>

    <p>
      The image below is provided from a PDF file in <latex /> output, and was
      converted to an SVG for use with the HTML output. It has been explicitly
      scaled to a width of 65% of the text width.
    </p>

    <figure xml:id="figure-complete-graph">
      <caption>
        Complete graph on <m>16</m> vertices, from <c>www.texample.net</c>
      </caption><image source="images/complete-graph" width="65%" />
    </figure>

    <remark>
      <title>Footnote Buried</title>

      <p>
        Nested <c>tcolorbox</c> (in <latex /> conversion) need special care when
        footnotes are interior.
      </p>

      <sidebyside margins="20% 30%">
        <p>
          A paragraph interior to a <c>sidebyside</c> with a footnote<fn>
             Interior footnote.
          </fn> buried inside the paragraph.
        </p>
        <p>A second paragraph, just to avoid a one-panel warning.</p>
      </sidebyside>

      <p>
        The final paragraph of this remark, randomly placed, to test footnotes
        in <latex /> conversions.
      </p>
    </remark>
  </subsection>

  <subsection>
    <title><latex /> images</title>
    <idx><latex /> image</idx><idx><h>image</h><h><latex /> image</h></idx>

    <p>
      There are several graphics engine packages that a <latex /> document can
      employ. Code from these packages renders diagrams automatically as part of
      normal processing of <latex /> files. For HTML output the <c>pretext</c>
      script produces SVG versions of the pictures. The script can also produce
      standalone <tex /> source files, PDFs, PNGs, and EPSs. The packages should
      be loaded in <c>docinfo/latex-image-preamble</c>, which is also where global
      package settings should be made. If any ampersands occur in your <latex />
      code you should use the <c>\amp</c> macro pre-defined by <pretext />.
      These first examples are from the
      <url
        href="http://www.texample.net/tikz/examples/"
        visual="www.texample.net/tikz/examples/"
      >TeXample.net</url>
      site. Note that any <latex /> macros used in the rest of your document may
      be employed in the <latex />-standalone or Asymptote diagrams (with this feature
      coming to Sage graphics next?).
    </p>

    <figure xml:id="figure-tikz-electronics">
      <caption>TikZ Electronics Diagram</caption><image
        xml:id="tikz-electronics"
      >
        <description>
          A pile of electronic components wired together
        </description><latex-image>
           \tikzset{% block/.style = {draw, thick, rectangle, minimum height = 3em,
          minimum width = 3em}, sum/.style = {draw, circle, node distance = 2cm},
          % Adder input/.style = {coordinate}, % Input output/.style = {coordinate}
          % Output } % Defining string as labels of certain blocks. \newcommand{\suma}{\Large$+$}
          \newcommand{\inte}{$\displaystyle \int$} \newcommand{\derv}{\huge$\frac{d}{dt}$}

           \begin{tikzpicture}[auto, thick, node distance=2cm, >=triangle 45] \draw
          % Drawing the blocks of first filter : node at (0,0)[right=-3mm]{\Large
          \textbullet} node [input, name=input1] {} node [sum, right of=input1] (suma1)
          {\suma} node [block, right of=suma1] (inte1) {\inte} node at (6.8,0)[block]
          (Q1) {\Large $Q_1$} node [block, below of=inte1] (ret1) {\Large$T_1$};
          % Joining blocks. % Commands \draw with options like [->] must be
          written individually \draw[->](input1) -- node {$X(Z)$}(suma1);
          \draw[->](suma1) -- node {} (inte1); \draw[->](inte1) -- node {} (Q1);
          \draw[->](ret1) -| node[near end]{} (suma1); % Adder \draw node at
          (5.4,-4) [sum, name=suma2] {\suma} % Second stage of filter node at
          (1,-6) [sum, name=suma3] {\suma} node [block, right of=suma3] (inte2)
          {\inte} node [sum, right of=inte2] (suma4) {\suma} node [block, right
          of=suma4] (inte3) {\inte} node [block, right of=inte3] (Q2) {\Large$Q_2$}
          node at (9,-8) [block, name=ret2] {\Large$T_2$} ; % Joining the blocks
          of second filter \draw[->] (suma3) -- node {} (inte2); \draw[->]
          (inte2) -- node {} (suma4); \draw[->] (suma4) -- node {} (inte3);
          \draw[->] (inte3) -- node {} (Q2); \draw[->] (ret2) -| (suma3);
          \draw[->] (ret2) -| (suma4); % Third stage of filter: % Defining
          nodes: \draw node at (11.5, 0) [sum, name=suma5]{\suma} node [output,
          right of=suma5]{} node [block, below of=suma5] (deriv1){\derv} node
          [output, right of=suma5] (sal2){} ; % Joining the blocks: \draw[->]
          (suma2) -| node {}(suma3); \draw[->] (Q1) -- (8,0) |- node {}(ret1);
          \draw[->] (8,0) |- (suma2); \draw[->] (5.4,0) -- (suma2); \draw[->]
          (Q1) -- node {}(suma5); \draw[->] (deriv1) -- node {}(suma5);
          \draw[->] (Q2) -| node {}(deriv1); \draw[&lt;->] (ret2) -| node
          {}(deriv1); \draw[->] (suma5) -- node {$Y(Z)$}(sal2); % Drawing nodes
          with \textbullet \draw node at (8,0) {\textbullet} node at
          (8,-2){\textbullet} node at (5.4,0){\textbullet} node at
          (5,-8){\textbullet} node at (11.5,-6){\textbullet} ; % Boxing and
          labelling noise shapers \draw [color=gray,thick](-0.5,-3) rectangle
          (9,1); \node at (-0.5,1) [above=5mm, right=0mm] {\textsc{first-order
          noise shaper}}; \draw [color=gray,thick](-0.5,-9) rectangle (12.5,-5);
          \node at (-0.5,-9) [below=5mm, right=0mm] {\textsc{second-order noise
          shaper}}; \end{tikzpicture}
        </latex-image>
      </image>
    </figure>

    <p>
      The next example began life in
      <url
        href="http://www.frontiernet.net/~eugene.ressler/"
        visual="www.frontiernet.net/~eugene.ressler/"
      >Sketch</url>, which will output TikZ code (though the code has been edited
      by hand for readability).
    </p>

    <figure xml:id="figure-tikz-cone3D">
      <caption>TikZ Cone Drawing</caption><image xml:id="tikz-cone" width="70%">
         <latex-image>
           \begin{tikzpicture}[join=round] \tikzstyle{conefill} = [fill=blue!20,fill
          opacity=0.8] \tikzstyle{ann} = [fill=white,font=\footnotesize,inner sep=1pt]
          \tikzstyle{ghostfill} = [fill=white] \tikzstyle{ghostdraw} = [draw=black!50]
          \filldraw[conefill](-.775,1.922)--(-1.162,.283)--(-.274,.5) --(-.183,2.067)--cycle;
          \filldraw[conefill](-.183,2.067)--(-.274,.5)--(.775,.424) --(.516,2.016)--cycle;
          \filldraw[conefill](.516,2.016)--(.775,.424)--(1.369,.1) --(.913,1.8)--cycle;
          \filldraw[conefill](-.913,1.667)--(-1.369,-.1)--(-1.162,.283) --(-.775,1.922)--cycle;
          \draw(1.461,.107)--(1.734,.127); \draw[arrows=&lt;->](1.643,1.853)--(1.643,.12);
          \filldraw[conefill](.913,1.8)--(1.369,.1)--(1.162,-.283) --(.775,1.545)--cycle;
          \draw[arrows=->,line width=.4pt](.274,-.5)--(0,0)--(0,2.86); \draw[arrows=-,line
          width=.4pt](0,0)--(-1.369,-.1); \draw[arrows=->,line width=.4pt](-1.369,-.1)--(-2.1,-.153);
          \filldraw[conefill](-.516,1.45)--(-.775,-.424)--(-1.369,-.1) --(-.913,1.667)--cycle;
          \draw(-1.369,.073)--(-1.369,2.76); \draw(1.004,1.807)--(1.734,1.86); \filldraw[conefill](.775,1.545)--(1.162,-.283)--(.274,-.5)
          --(.183,1.4)--cycle; \draw[arrows=&lt;->](0,2.34)--(-.913,2.273); \draw(-.913,1.84)--(-.913,2.447);
          \draw[arrows=&lt;->](0,2.687)--(-1.369,2.587); \filldraw[conefill](.183,1.4)--(.274,-.5)--(-.775,-.424)
          --(-.516,1.45)--cycle; \draw[arrows=&lt;-,line width=.4pt](.42,-.767)--(.274,-.5);
          \node[ann] at (-.456,2.307) {$r_0$}; \node[ann] at (-.685,2.637) {$r_1$};
          \node[ann] at (1.643,.987) {$h$}; \path (.42,-.767) node[below] {$x$} (0,2.86)
          node[above] {$y$} (-2.1,-.153) node[left] {$z$}; % Second version of the
          cone \begin{scope}[xshift=3.5cm] \filldraw[ghostdraw,ghostfill](-.775,1.922)--(-1.162,.283)--(-.274,.5)
          --(-.183,2.067)--cycle; \filldraw[ghostdraw,ghostfill](-.183,2.067)--(-.274,.5)--(.775,.424)
          --(.516,2.016)--cycle; \filldraw[ghostdraw,ghostfill](.516,2.016)--(.775,.424)--(1.369,.1)
          --(.913,1.8)--cycle; \filldraw[ghostdraw,ghostfill](-.913,1.667)--(-1.369,-.1)--(-1.162,.283)
          --(-.775,1.922)--cycle; \filldraw[ghostdraw,ghostfill](.913,1.8)--(1.369,.1)--(1.162,-.283)
          --(.775,1.545)--cycle; \filldraw[ghostdraw,ghostfill](-.516,1.45)--(-.775,-.424)--(-1.369,-.1)
          --(-.913,1.667)--cycle; \filldraw[ghostdraw,ghostfill](.775,1.545)--(1.162,-.283)--(.274,-.5)
          --(.183,1.4)--cycle; \filldraw[fill=red,fill opacity=0.5](-.516,1.45)--(-.775,-.424)--(.274,-.5)
          --(.183,1.4)--cycle; \fill(-.775,-.424) circle (2pt); \fill(.274,-.5) circle
          (2pt); \fill(-.516,1.45) circle (2pt); \fill(.183,1.4) circle (2pt); \path[font=\footnotesize]
          (.913,1.8) node[right] {$i\hbox{$=$}0$} (1.369,.1) node[right] {$i\hbox{$=$}1$};
          \path[font=\footnotesize] (-.645,.513) node[left] {$j$} (.228,.45) node[right]
          {$j\hbox{$+$}1$}; \draw (-.209,.482)+(-60:.25) [yscale=1.3,->] arc(-60:240:.25);
          \fill[black,font=\footnotesize] (-.516,1.45) node [above] {$P_{00}$} (-.775,-.424)
          node [below] {$P_{10}$} (.183,1.4) node [above] {$P_{01}$} (.274,-.5) node
          [below] {$P_{11}$}; \end{scope} \end{tikzpicture}
        </latex-image>
      </image>
    </figure>

    <p>
      The pgfplots package was included in <c>docinfo/latex-image-preamble</c>. Here,
      it is used. Also, here we demonstrate using <c>\amp</c> where you would normally
      use an ampersand in <latex />. There are known issues with <c>xelatex</c>
      processing any gradient shading in <c>tikz</c>. To (successfully) create the
      gradient shading in the 3D image here, you may need to use <c>pdflatex</c>
      until <latex /> developers resolve this issue.
    </p>

    <figure xml:id="figure-pgfplots-demo">
      <caption>Sample pgfplots plot</caption><image xml:id="pgfplots-demo">
        <description>
          A pgfplots example, with a function, a parametric curve, and some
          points plotted.
        </description><latex-image>
           \begin{tikzpicture} \matrix{ \begin{axis}[width = 0.5\linewidth] \addplot[
          domain = 0.1:10, &lt;->, smooth, thin, color = blue, ]{4*ln(x)/ln(10)};
          \addplot[ only marks, ]coordinates{ (0,2) (4,3) (2,4) (3,4)}; \addplot[
          variable = \t, domain = 0:360, samples = 200, color = orange, ]({3*sin(2*t)},
          {2*cos(5*t)}); \end{axis} \amp \begin{axis}[axis lines = box, width = 0.5\linewidth]
          \addplot3[ surf, faceted color = blue, samples = 15, domain = 0:1, y domain
          = -1:1 ]{x^2 - y^2}; \end{axis}\\ }; \end{tikzpicture}


        </latex-image>
      </image>
    </figure>

    <p>
      A plot might use a graphics language to draw the axes and grid, but the
      data might be from an experiment and live in an external file that you do
      not wish to place in your source. Place such a file in a subdirectory
      directly below the directory where your master source file resides. In the
      example below <c>data</c> is the directory and
      <c>hodgkin-huxley-data.dat</c> is the file with the data points. You
      <em>must</em> place the file in a subdirectory (it cannot reside next to
      your source file), but that directory may have subdirectories if you have
      many such files and want to organize them that way. Then the
      <c>--include</c> command-line argument to the <c>pretext</c> script will
      manage the external files properly as it creates individual image files.
    </p>

    <p>
      It is still your responsibility to be sure this directory of external data
      files follows your <latex /> output to whatever directory you use to
      convert to a PDF and is in the right location for the relative path given
      in the XML source. The discussion above only applies to generating
      individual image files, such as you would need for the HTML output.
    </p>

    <figure xml:id="figure-pgfplots-data-demo">
      <caption>External data in a pgfplots plot</caption><image
        xml:id="pgfplots-data-demo"
      >
        <description>
          A pgfplots example, with external data plotted.
        </description><latex-image>
           \begin{tikzpicture} \begin{axis}[ xmin=0,xmax=100,ymin=-20,ymax=100, ytick={-20,0,...,100},
          xlabel={time (ms)}, ylabel={potential (V)}, ] \addplot[blue] table {external/data/hodgkin-huxley-data.dat};
          \end{axis} \end{tikzpicture}
        </latex-image>
      </image>
    </figure>

    <p>
      PSTricks is a <latex /> package for drawing diagrams and pictures, dating
      back to the days before <init>PDF</init>, when PostScript (<init>
         PS
      </init>) was king. Given its history, it does not seem to work easily with
      the <c>pdflatex</c> engine. But it will work easily with the <c>
         xelatex
      </c> engine. We try to keep this present sample document workable with both
      engines, so we have presented an example of the use of PSTricks in the <c>
         xelatex
      </c>-exclusive sample document where we test obscure fonts and characters.
      So your best bet is to look there.<idx>PSTricks</idx>
    </p>

    <p>
      There are suggestions online that <cd>\usepackage[pdf]{pstricks}</cd>along
      with <cd>pdflatex --shell-escape *.tex</cd> is workable. We could not make
      it happen, and a
      <q>shell escape</q>
       can be a dangerous security hole. That said, updates to this approach are
      welcome.
    </p>
  </subsection>

  <subsection>

    <title>Asymptote, 2D</title>

    <p>
      The Asymptote<idx><h>asymptote graphics language</h></idx> graphics language
      may be placed in your source to draw graphs, diagrams or pictures. Rules for
      formatting code are identical to those for Sage code. For more on Asymptote
      see <url
        href="http://asymptote.sourceforge.net/"
        visual="asymptote.sourceforge.net"
      />.
    </p>

    <p>
      This is a simple physics diagram about levers, taken from the Asymptote
      documentation. In the HTML version of this article, the images are SVG's
      and so should scale nicely when you zoom in on the page.
    </p>

    <figure xml:id="figure-asymptote-levers">
      <caption>Asymptote Lever Demonstration</caption><image
        xml:id="asymptote-lever"
      >
        <description>Moments on a lever</description><asymptote>
           size(200,0);

           pair z0=(0,0); pair z1=(2,0); pair z2=(5,0); pair zf=z1+0.75*(z2-z1);

           draw(z1--z2); dot(z1,red+0.15cm); dot(z2,darkgreen+0.3cm); label("$m$",z1,1.2N,red);
          label("$M$",z2,1.5N,darkgreen); label("$\hat{\ }$",zf,0.2*S,fontsize(24pt)+blue);

           pair s=-0.2*I; draw("$x$",z0+s--z1+s,N,red,Arrows,Bars,PenMargins);

           s=-0.5*I; draw("$\bar{x}$",z0+s--zf+s,blue,Arrows,Bars,PenMargins);

           s=-0.95*I; draw("$X$",z0+s--z2+s,darkgreen,Arrows,Bars,PenMargins);


        </asymptote>
      </image>
    </figure>
  </subsection>
</section>
